$(document).on("click","#setup_my .pinset",function(){function b(){var b={op:"setup_my_pinset",pin:$.trim($("#pin").val())};b.pin?3>b.pin.length?(a("Длина пин-кода от 3 до 10 символов"),$("#pin").focus()):(c.process(),$.post(AJAX_MAIN,b,function(a){a.success?(c.close(),_msg("Пин-код установлен."),document.location.reload()):c.abort()},"json")):(a("Введите пин-код"),$("#pin").focus())}function a(a){c.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:-47,left:52,indent:50,show:1,remove:1})}$(this);
var c=_dialog({width:300,head:"Установка нового пин-кода",content:'<table class="setup-tab"><tr><td class="label">Новый пин-код:<td><input id="pin" type="password" maxlength="10" /></table>',butSubmit:"Установить",submit:b});$("#pin").focus().keyEnter(b)}).on("click","#setup_my .pinchange",function(){function b(){var b={op:"setup_my_pinchange",oldpin:$.trim($("#oldpin").val()),pin:$.trim($("#pin").val())};b.oldpin&&b.pin?3>b.oldpin.length||3>b.pin.length?a("Длина пин-кода от 3 до 10 символов"):(c.process(),
$.post(AJAX_MAIN,b,function(b){b.success?(c.close(),_msg("Пин-код изменён."),document.location.reload()):(c.abort(),a(b.text))},"json")):a("Заполните оба поля")}function a(a){c.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:-47,left:52,indent:50,show:1,remove:1})}$(this);var c=_dialog({width:300,head:"Изменение пин-кода",content:'<table class="setup-tab"><tr><td class="label">Текущий пин-код:<td><input id="oldpin" type="password" maxlength="10" /><tr><td class="label">Новый пин-код:<td><input id="pin" type="password" maxlength="10" /></table>',
butSubmit:"Изменить",submit:b});$("#oldpin").focus().keyEnter(b);$("#pin").keyEnter(b)}).on("click","#setup_my .pindel",function(){function b(){var b={op:"setup_my_pindel",oldpin:$.trim($("#oldpin").val())};b.oldpin?3>b.oldpin.length?(a("Длина пин-кода от 3 до 10 символов"),$("#oldpin").focus()):(c.process(),$.post(AJAX_MAIN,b,function(b){b.success?(c.close(),_msg("Пин-код удалён."),document.location.reload()):(c.abort(),a(b.text))},"json")):(a("Заполните оба поля"),$("#oldpin").focus())}function a(a){c.bottom.vkHint({msg:'<span class="red">'+
a+"</span>",top:-47,left:52,indent:50,show:1,remove:1})}$(this);var c=_dialog({width:300,head:"Удаление пин-кода",content:'<table class="setup-tab"><tr><td class="label">Текущий пин-код:<td><input id="oldpin" type="password" maxlength="10" /></table>',butSubmit:"Применить",submit:b});$("#oldpin").focus().keyEnter(b)}).on("click","#setup_worker .add",function(){function b(){if(!d.hasClass("busy")){e=0;$(".res").remove();var a={user_ids:$.trim($("#viewer_id").val()),fields:"photo_50",v:5.2};a.user_ids&&
(/vk.com/.test(a.user_ids)&&(a.user_ids=a.user_ids.split("vk.com/")[1]),/\?/.test(a.user_ids)&&(a.user_ids=a.user_ids.split("?")[0]),/#/.test(a.user_ids)&&(a.user_ids=a.user_ids.split("#")[0]),d.addClass("busy"),VK.api("users.get",a,function(a){d.removeClass("busy");a.response&&(a=a.response[0],d.after('<table class="res"><tr><td class="photo"><img src='+a.photo_50+'><td class="name">'+a.first_name+" "+a.last_name+"</table>"),e=a.id)}))}}function a(a,b){c.bottom.vkHint({msg:'<SPAN class="red">'+a+
"</SPAN>",remove:1,indent:40,show:1,top:b,left:90})}var c=_dialog({top:50,width:350,head:"Добавление нового сотрудника",content:'<div id="setup_worker_add"><h1>Укажите адрес страницы пользователя или его<br />ID ВКонтакте:</h1><h2>Формат адреса может быть следующих видов:<br /><u>http://vk.com/id12345</u>, <u>http://vk.com/durov</u>.<br />Либо используйте ID пользователя: <u>id12345</u>, <u>durov</u>, <u>12345</u>.</h2><input type="text" id="viewer_id" /><div class="vkButton"><button>Найти</button></div><a class="manual">Или заполните данные вручную..</a><table class="manual_tab"><tr><td class="label">Имя:<td><input type="text" id="first_name" /><tr><td class="label">Фамилия:<td><input type="text" id="last_name" /><tr><td class="label">Пол:<td><input type="hidden" id="sex" value="0" /><tr><td class="label">Должность:<td><input type="text" id="post" /></table></div>',
butSubmit:"Добавить",submit:function(){var b={op:"setup_worker_add",viewer_id:e,first_name:$("#first_name").val(),last_name:$("#last_name").val(),sex:$("#sex").val(),post:$("#post").val()};b.viewer_id||b.first_name||b.last_name?b.first_name&&b.last_name&&0==b.sex?a("Не указан пол",-47):(c.process(),$.post(AJAX_MAIN,b,function(b){b.success?(c.close(),_msg("Новый сотрудник успешно добавлен."),$("#spisok").html(b.html)):(c.abort(),a(b.text,-60))},"json")):a("Произведите поиск пользователя<br>или укажите вручную имя и фамилию",
-60)}}),e=0,d=$("#viewer_id").focus().keyEnter(b).next();d.click(b);$(".manual").click(function(){$(this).hide().next().show();$(".res").remove();e=0;$("#viewer_id").val("");$("#first_name").focus()});$("#sex")._radio({spisok:[{uid:2,title:"М"},{uid:1,title:"Ж"}]})}).on("click","#setup_worker .img_del",function(){for(var b=$(this);!b.hasClass("unit");)b=b.parent();var a=_dialog({top:110,width:250,head:"Удаление сотрудника",content:"<center>Подтвердите удаление сотрудника.</center>",butSubmit:"Удалить",
submit:function(){var c={op:"setup_worker_del",viewer_id:b.attr("val")};a.process();$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("Сотрудник удален."),$("#spisok").html(b.html)):a.abort()},"json")}})}).on("click","#setup_product .add",function(){function b(){var b={op:"setup_product_add",name:$("#name").val()};b.name?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($(".spisok").html(b.html),a.close(),_msg("Внесено!")):a.abort()},"json")):(a.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",
top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}$(this);var a=_dialog({top:60,width:390,head:"Добавление нового наименования изделия",content:'<table style="border-spacing:10px"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" style="width:250px" /></table>',submit:b});$("#name").focus().keyEnter(b)}).on("click","#setup_product .img_edit",function(){function b(){var a={op:"setup_product_edit",id:c,name:$("#name").val()};a.name?(d.process(),$.post(AJAX_MAIN,
a,function(a){a.success?($(".spisok").html(a.html),d.close(),_msg("Сохранено!")):d.abort()},"json")):(d.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var c=a.attr("val"),e=a.find(".name a");a.find(".dog").html();var a='<table style="border-spacing:10px"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" style="width:250px" value="'+
e.html()+'" /></table>',d=_dialog({top:60,width:390,head:"Редактирование наименования изделия",content:a,butSubmit:"Сохранить",submit:b});$("#name").focus().keyEnter(b)}).on("click","#setup_product .img_del",function(){var b=$(this),a=_dialog({top:90,width:300,head:"Удаление изделия",content:"<center><b>Подтвердите удаление изделия.</b></center>",butSubmit:"Удалить",submit:function(){for(;"TR"!=b[0].tagName;)b=b.parent();var c={op:"setup_product_del",id:b.attr("val")};a.process();$.post(AJAX_MAIN,
c,function(c){c.success?(b.remove(),a.close(),_msg("Удалено!")):a.abort()},"json")}})}).on("click","#setup_product_sub .add",function(){function b(){var b={op:"setup_product_sub_add",product_id:PRODUCT_ID,name:$("#name").val()};b.name?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($(".spisok").html(b.html),a.close(),_msg("Внесено!")):a.abort()},"json")):(a.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}$(this);
var a=_dialog({top:60,width:390,head:"Добавление нового подвида изделия",content:'<table style="border-spacing:10px"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" style="width:250px" /></table>',submit:b});$("#name").focus().keyEnter(b)}).on("click","#setup_product_sub .img_edit",function(){function b(){var b={op:"setup_product_sub_edit",id:a.attr("val"),name:$("#name").val()};b.name?(d.process(),$.post(AJAX_MAIN,b,function(a){a.success?(c.html(b.name),d.close(),
_msg("Сохранено!")):d.abort()},"json")):(d.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var c=a.find(".name"),e='<table style="border-spacing:10px"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" style="width:250px" value="'+c.html()+'" /></table>',d=_dialog({top:60,width:390,head:"Редактирование подвида изделия",content:e,butSubmit:"Сохранить",
submit:b});$("#name").focus().keyEnter(b)}).on("click","#setup_product_sub .img_del",function(){var b=$(this),a=_dialog({top:90,width:300,head:"Удаление подвида",content:"<center><b>Подтвердите удаление подвида изделия.</b></center>",butSubmit:"Удалить",submit:function(){for(;"TR"!=b[0].tagName;)b=b.parent();var c={op:"setup_product_sub_del",id:b.attr("val")};a.process();$.post(AJAX_MAIN,c,function(c){c.success?(b.remove(),a.close(),_msg("Удалено!")):a.abort()},"json")}})}).on("click","#setup_invoice .add",
function(){function b(){var b={op:"setup_invoice_add",name:$("#name").val(),about:$("#about").val(),income:$("#income").val(),transfer:$("#transfer").val(),visible:$("#visible").val()};b.name?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($(".spisok").html(b.html),a.close(),_msg("Внесено!")):(a.abort(),a.err(b.text))},"json")):(a.err("Не указано наименование"),$("#name").focus())}$(this);var a=_dialog({top:40,width:430,head:"Добавление нового счёта",content:'<table class="setup-tab"><tr><td class="label">Наименование:<td><input id="name" type="text" /><tr><td class="label topi">Описание:<td><textarea id="about"></textarea><tr><td class="label">Подтверждение поступления:<td><input type="hidden" id="income" /><tr><td class="label">Подтверждение перевода:<td><input type="hidden" id="transfer" /><tr><td class="label topi">Видимость для сотрудников:<td><input type="hidden" id="visible" /></table>',
submit:b});$("#name").focus().keyEnter(b);$("#about").autosize();$("#income")._check();$("#income_check").vkHint({msg:"Возможность требовать подтверждение поступления средств на счёт",width:180,top:-84,left:-85,delayShow:500});$("#transfer")._check();$("#visible")._select({width:218,multiselect:1,spisok:WORKER_SPISOK})}).on("click","#setup_invoice .img_edit",function(){function b(){var a={op:"setup_invoice_edit",id:c,name:$("#name").val(),about:$("#about").val(),income:$("#income").val(),transfer:$("#transfer").val(),
visible:$("#visible").val()};a.name?(g.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),g.close(),_msg("Сохранено!")):(g.abort(),g.err(a.text))},"json")):(g.err("Не указано наименование"),$("#name").focus())}for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var c=a.attr("val"),e=a.find(".name div").html(),d=a.find(".name pre").html(),h=a.find(".confirm_income").val(),f=a.find(".confirm_transfer").val(),a=a.find(".visible_id").val(),g=_dialog({width:480,head:"Редактирование данных счёта",
content:'<table class="setup-tab"><tr><td class="label">Наименование:<td><input id="name" type="text" value="'+e+'" /><tr><td class="label topi">Описание:<td><textarea id="about">'+d+'</textarea><tr><td class="label">Подтверждение поступления:<td><input type="hidden" id="income" value="'+h+'" /><tr><td class="label">Подтверждение перевода:<td><input type="hidden" id="transfer" value="'+f+'" /><tr><td class="label topi">Видимость<br />для сотрудников:<td><input type="hidden" id="visible" value="'+
a+'" /></table>',butSubmit:"Сохранить",submit:b});$("#name").focus().keyEnter(b);$("#about").autosize();$("#income")._check();$("#income_check").vkHint({msg:"Возможность требовать подтверждение поступления средств на счёт",width:180,top:-84,left:-85,delayShow:500});$("#transfer")._check();$("#visible")._select({width:218,multiselect:1,spisok:WORKER_SPISOK})}).on("click","#setup_invoice .img_del",function(){var b=$(this),a=_dialog({top:90,width:300,head:"Удаление счёта",content:"<center><b>Подтвердите удаление счёта.</b></center>",
butSubmit:"Удалить",submit:function(){for(;"TR"!=b[0].tagName;)b=b.parent();var c={op:"setup_invoice_del",id:b.attr("val")};a.process();$.post(AJAX_MAIN,c,function(b){b.success?($(".spisok").html(b.html),a.close(),_msg("Удалено!")):a.abort()},"json")}})}).on("click","#setup_expense .add",function(){function b(){var b={op:"setup_expense_add",name:$("#name").val(),show_worker:$("#show_worker").val()};b.name?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($(".spisok").html(b.html),a.close(),_msg("Внесено!"),
sortable()):a.abort()},"json")):(a.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:131,indent:50,show:1,remove:1}),$("#name").focus())}$(this);var a=_dialog({width:400,head:"Добавление новой категории расхода организации",content:'<table class="setup-tab"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="50" /><tr><td class="label r">Список сотрудников:<td><input id="show_worker" type="hidden" /></table>',submit:b});$("#name").focus().keyEnter(b);
$("#show_worker")._check()}).on("click","#setup_expense .img_edit",function(){function b(){var a={op:"setup_expense_edit",id:c,name:$("#name").val(),show_worker:$("#show_worker").val()};a.name?(d.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),d.close(),_msg("Сохранено!"),sortable()):d.abort()},"json")):(d.bottom.vkHint({msg:'<span class="red">Не указано наименование</span>',top:-47,left:131,indent:50,show:1,remove:1}),$("#name").focus())}for(var a=$(this);"DD"!=a[0].tagName;)a=
a.parent();var c=a.attr("val"),e=a.find(".name").html(),a=a.find(".worker").html()?1:0,d=_dialog({width:400,head:"Редактирование категории расхода организации",content:'<table class="setup-tab"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="50" value="'+e+'" /><tr><td class="label r">Список сотрудников:<td><input id="show_worker" type="hidden" value="'+a+'" /></table>',butSubmit:"Сохранить",submit:b});$("#name").focus().keyEnter(b);$("#show_worker")._check()}).on("click",
"#setup_expense .img_del",function(){var b=$(this),a=_dialog({top:90,head:"Удаление категории расхода организации",content:"<center><b>Подтвердите удаление.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=b[0].tagName;)b=b.parent();var c={op:"setup_expense_del",id:b.attr("val")};a.process();$.post(AJAX_MAIN,c,function(b){b.success?($(".spisok").html(b.html),a.close(),_msg("Удалено!"),sortable()):a.abort()},"json")}})}).on("click","#setup_zayavexpense .add",function(){function b(){var a=
{op:"setup_zayav_expense_add",name:$("#name").val(),show_txt:$("#show_txt").val(),show_worker:$("#show_worker").val()};a.name?(c.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),c.close(),_msg("Внесено!"),sortable()):c.abort()},"json")):(c.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:131,indent:50,show:1,remove:1}),$("#name").focus())}function a(a,b){1==a&&("show_txt"==b?$("#show_worker")._check(0):$("#show_txt")._check(0))}$(this);
var c=_dialog({top:60,width:440,head:"Добавление новой категории расхода заявки",content:'<table style="border-spacing:10px"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="50" style="width:210px" /><tr><td class="label r">Текстовое поле:<td><input id="show_txt" type="hidden" /><tr><td class="label r">Список сотрудников:<td><input id="show_worker" type="hidden" /></table>',submit:b});$("#name").focus().keyEnter(b);$("#show_txt")._check({func:a});$("#show_worker")._check({func:a})}).on("click",
"#setup_zayavexpense .img_edit",function(){function b(){var a={op:"setup_zayav_expense_edit",id:e,name:$("#name").val(),show_txt:$("#show_txt").val(),show_worker:$("#show_worker").val()};a.name?(f.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),f.close(),_msg("Сохранено!"),sortable()):f.abort()},"json")):(f.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:131,indent:50,show:1,remove:1}),$("#name").focus())}function a(a,b){1==a&&("show_txt"==
b?$("#show_worker")._check(0):$("#show_txt")._check(0))}for(var c=$(this);"DD"!=c[0].tagName;)c=c.parent();var e=c.attr("val"),d=c.find(".name").html(),h=c.find(".txt").html()?1:0,c=c.find(".worker").html()?1:0,f=_dialog({top:60,width:440,head:"Редактирование категории расхода заявки",content:'<table style="border-spacing:10px"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="50" style="width:210px" value="'+d+'" /><tr><td class="label r">Текстовое поле:<td><input id="show_txt" type="hidden" value="'+
h+'" /><tr><td class="label r">Список сотрудников:<td><input id="show_worker" type="hidden" value="'+c+'" /></table>',butSubmit:"Сохранить",submit:b});$("#name").focus().keyEnter(b);$("#show_txt")._check({func:a});$("#show_worker")._check({func:a})}).on("click","#setup_zayavexpense .img_del",function(){var b=$(this),a=_dialog({top:90,width:300,head:"Удаление категории расхода заявки",content:"<center><b>Подтвердите удаление<br />категории расхода заявки.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=
b[0].tagName;)b=b.parent();var c={op:"setup_zayav_expense_del",id:b.attr("val")};a.process();$.post(AJAX_MAIN,c,function(b){b.success?($(".spisok").html(b.html),a.close(),_msg("Удалено!"),sortable()):a.abort()},"json")}})}).ready(function(){$("#setup_rules").length&&($(".g-save").click(function(){function b(a){c.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-57,left:-6,indent:40,show:1,remove:1})}var a={op:"setup_worker_save",viewer_id:RULES_VIEWER_ID,first_name:$("#first_name").val(),last_name:$("#last_name").val(),
middle_name:$("#middle_name").val(),post:$("#post").val()},c=$(this);a.first_name?a.last_name?(c.addClass("busy"),$.post(AJAX_MAIN,a,function(a){c.removeClass("busy");a.success&&_msg("Сохранено.")},"json")):(b("Не указана фамилия"),$("#last_name").focus()):(b("Не указано имя"),$("#first_name").focus())}),$(".pin-clear").click(function(){var b={op:"setup_worker_pinclear",viewer_id:RULES_VIEWER_ID},a=$(this);a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){a.removeClass("busy");
b.success&&_msg("Пин-код сброшен.")},"json"))}),$("#rules_appenter")._check(function(b){$(".app-div")[(0==b?"add":"remove")+"Class"]("dn");$("#rules_worker")._check(0);$("#rules_rules")._check(0);$("#rules_rekvisit")._check(0);$("#rules_product")._check(0);$("#rules_invoice")._check(0);$("#rules_zayavrashod")._check(0);$("#rules_historyshow")._check(0);$("#rules_money")._dropdown(0)}),$("#rules_money")._dropdown({spisok:[{uid:0,title:"только свои"},{uid:1,title:"все платежи"}]}),$(".rules-save").click(function(){var b=
{op:"setup_worker_rules_save",viewer_id:RULES_VIEWER_ID,rules_appenter:$("#rules_appenter").val(),rules_worker:$("#rules_worker").val(),rules_rules:$("#rules_rules").val(),rules_rekvisit:$("#rules_rekvisit").val(),rules_product:$("#rules_product").val(),rules_invoice:$("#rules_invoice").val(),rules_zayavrashod:$("#rules_zayavrashod").val(),rules_historyshow:$("#rules_historyshow").val(),rules_money:$("#rules_money").val()},a=$(this);a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){a.removeClass("busy");
b.success&&_msg("Права сохранены.")},"json"))}),$(".dop-save").click(function(){var b={op:"setup_worker_dop_save",viewer_id:RULES_VIEWER_ID,rules_nosalary:$("#rules_nosalary").val(),rules_zpzayavauto:$("#rules_zpzayavauto").val()},a=$(this);a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){a.removeClass("busy");b.success&&_msg("Дополнительные настройки сохранены.")},"json"))}));$("#setup_rekvisit").length&&$(".vkButton").click(function(){var b=$(this),a={op:"setup_rekvisit",org_name:$("#org_name").val(),
ogrn:$("#ogrn").val(),inn:$("#inn").val(),kpp:$("#kpp").val(),yur_adres:$("#yur_adres").val(),telefon:$("#telefon").val(),ofice_adres:$("#ofice_adres").val()};b.addClass("busy");$.post(AJAX_MAIN,a,function(a){b.removeClass("busy");a.success&&_msg("Информация сохранена.")},"json")})});
