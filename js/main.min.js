var hashLoc,hashSet=function(a){if(a||a.p){hashLoc=a.p;switch(a.p){case "client":"info"==a.d&&(hashLoc+="_"+a.id);break;case "zayav":"info"==a.d?hashLoc+="_"+a.id:"add"==a.d&&(hashLoc+="_add"+(REGEXP_NUMERIC.test(a.id)?"_"+a.id:""));break;default:a.d&&(hashLoc+="_"+a.d,a.d1&&(hashLoc+="_"+a.d1))}VK.callMethod("setLocation",hashLoc)}},pinEnter=function(){var a={op:"pin_enter",pin:$.trim($("#pin").val())};a.pin&&2<a.pin.length&&($(".vkButton").addClass("busy"),$.post(AJAX_MAIN,a,function(a){a.success?
location.href=URL+"&p="+_cookie("p")+"&d="+_cookie("d")+"&id="+_cookie("id"):($(".vkButton").removeClass("busy"),$("#pin").val("").focus(),$(".red").html(a.text))},"json"))},clientAdd=function(a){function b(){var b={op:"client_add",fio:$("#c-fio").val(),telefon:$("#c-telefon").val(),adres:$("#c-adres").val(),pasp_seria:$("#pasp_seria").val(),pasp_nomer:$("#pasp_nomer").val(),pasp_adres:$("#pasp_adres").val(),pasp_ovd:$("#pasp_ovd").val(),pasp_data:$("#pasp_data").val()};b.fio?(c.process(),$.post(AJAX_MAIN,
b,function(b){b.success?(c.close(),_msg("����� ������ �����."),"function"==typeof a?a(b):document.location.href=URL+"&p=client&d=info&id="+b.uid):c.abort()},"json")):(c.bottom.vkHint({msg:'<SPAN class="red">�� ������� ��� �������.</SPAN>',top:-47,left:103,indent:40,show:1,remove:1}),$("#c-fio").focus())}var c=_dialog({width:380,head:"���������� �o���� �������",content:'<table class="client-add"><tr><td class="label">���:<td><input type="text" id="c-fio" maxlength="100"><tr><td class="label">�������:<td><input type="text" id="c-telefon" maxlength="100"><tr><td class="label">�����:<td><input type="text" id="c-adres" maxlength="100"><tr class="tr_pasp"><td colspan="2"><a>��������� ���������� ������</a><tr class="dn"><td><td><b>���������� ������:</b><tr class="dn"><td class="label">�����:<td><input type="text" id="pasp_seria" maxlength="8"><span class="label">�����:</span><input type="text" id="pasp_nomer" maxlength="10"><tr class="dn"><td class="label">��������:<td><input type="text" id="pasp_adres" maxlength="100"><tr class="dn"><td class="label">��� �����:<td><input type="text" id="pasp_ovd" maxlength="100"><tr class="dn"><td class="label">����� �����:<td><input type="text" id="pasp_data" maxlength="100"></table>',
submit:b});$("#c-fio").focus();$("#c-fio,#c-telefon,#c-adres").keyEnter(b);$(".tr_pasp a").click(function(){$(".tr_pasp").remove();$(".client-add .dn").removeClass("dn");$("#pasp_seria").focus()})},clientFilter=function(){var a={op:"client_spisok",fast:cFind.inp(),dolg:$("#dolg").val(),worker:$("#worker").val(),note:$("#note").val(),zayav_cat:$("#zayav_cat").val(),product_id:$("#product_id").val()};$(".filter")[a.fast?"hide":"show"]();return a},clientSpisok=function(){var a=clientFilter(),b=$(".result");
b.hasClass("busy")||(b.addClass("busy"),$.post(AJAX_MAIN,a,function(a){b.removeClass("busy");a.success&&(b.html(a.result),$(".left").html(a.spisok))},"json"))},zayavZamerDtime=function(a){a=$.extend({day:"",hour:10,min:0},a);a='<table><tr><td><INPUT TYPE="hidden" id="zamer_day" value="'+a.day+'" /><td><INPUT TYPE="hidden" id="zamer_hour" value="'+a.hour+'" /><td> : <td><INPUT TYPE="hidden" id="zamer_min" value="'+a.min+'" /></table>';$(".zayav-zamer-dtime").html(a);$("#zamer_day")._calendar();$("#zamer_hour")._select({width:40,
spisok:ZAMER_HOUR});$("#zamer_min")._select({width:40,spisok:ZAMER_MIN});$("#zamer_duration")._select({width:100,spisok:ZAMER_DURATION})},zayavFindFast=function(){var a={op:"zayav_findfast",find:$.trim($("#find input").val())};$(".find-hide")[(a.find?"add":"remove")+"Class"]("dn");a.find?($("#mainLinks").addClass("busy"),$.post(AJAX_MAIN,a,function(a){$("#mainLinks").removeClass("busy");a.success&&($("#zayav .result").html(a.result),$("#zayav #spisok").html(a.spisok))},"json")):zayavSpisok()},zayavFilter=
function(){return{op:"zayav_spisok",category:$("#zayav").attr("val"),product:$("#product_id").val(),status:$("#status").length?$("#status").val():0,zpe:$("#zp_expense").length?$("#zp_expense").val():0,zpe_worker:$("#zpe_worker").length?$("#zpe_worker").val():0,account:$("#account").length?$("#account").val():0}},zayavSpisok=function(){$("#mainLinks").addClass("busy");$.post(AJAX_MAIN,zayavFilter(),function(a){$("#mainLinks").removeClass("busy");a.success&&($("#zayav .result").html(a.result),$("#zayav #spisok").html(a.spisok))},
"json")},dogovorCreate=function(a){function b(b){var c={id:DOG.id,zayav_id:ZAYAV.id,fio:$("#fio").val(),adres:$("#adres").val(),pasp_seria:$("#pasp_seria").val(),pasp_nomer:$("#pasp_nomer").val(),pasp_adres:$("#pasp_adres").val(),pasp_ovd:$("#pasp_ovd").val(),pasp_data:$("#pasp_data").val(),nomer:$("#nomer").val(),data_create:$("#data_create").val(),sum:$("#sum").val(),avans:$("#avans").val(),cut:DOG.cut,reason:"reneg"==a?$("#reason").val():""};if(c.fio)if(REGEXP_NUMERIC.test(c.nomer)&&0!=c.nomer)if(REGEXP_CENA.test(c.sum)&&
0!=c.sum)if(c.avans&&!REGEXP_CENA.test(c.avans))h("����������� ������ ��������� �����","avans",b);else{if("reneg"!=a||c.reason)return c;h("�� ������� ������� �������������� ��������","reason",b)}else h("����������� ������� ����� �� ��������","sum",b);else h("����������� ������ ����� ��������","nomer",b);else h("�� ������� ��� �������","fio",b);return!1}function c(){var a=p[l-1],a='<tr><td class="label">'+l+'-� �����:<td><input type="text" class="cutsum" id="i'+l+'" maxlength="7" value="'+(a?a[0]:
"")+'"> ���. <input type="hidden" id="d'+l+'" value="'+(a?a[1]:"")+'">';$("#cut-add").before(a);1!=l||p[0]||$("#i1").val($("#cut-itog").html());$("#i"+l).focus().keyup(d);$("#d"+l)._calendar();l++}function d(){var a=$(".cutsum"),b=0,c,e=[];for(g=0;g<a.length;g++)if((c=$.trim(a.eq(g).val()))&&0!=c){if(!REGEXP_CENA.test(c)){b=!1;break}b+=1*c;e.push(1*c+":"+a.eq(g).next().find("input").val())}!1===b&&(b=Math.round(100*b)/100);$("#cut-itog").html(b);return!1===b?"error":e}function e(){var a=d();"error"==
a?r.bottom.vkHint({msg:'<span class="red">����������� ��������� ���� �������</span>',top:-47,left:84,indent:50,show:1,remove:1}):(DOG.cut=a.join(),f(),r.close())}function f(){var a=DOG.cut?DOG.cut.split(",").length:0;$("#cut").html(a?"������"+_end(a,["�","�"])+" ���"+_end(a,["�","�"])+" ��� "+a+_end(a,["-��","-�","-�"])+" ������"+_end(a,["�","��"])+'. <u>��������</u><div class="img_del'+_tooltip("�������� ��������",-61)+"</div>":m);a&&$("#cut .img_del").click(function(a){a.stopPropagation();DOG.cut=
"";$("#cut").html(m)})}function h(a,b,c){s.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:c?-86:-47,left:c?173:142,indent:50,show:1,remove:1});b&&$("#"+b).focus()}var g,k="����������",q="��������� �������",m="������� ���� ��������� ��������",l,r,p;switch(a){default:a="create";case "create":break;case "edit":k="��������� ������";q="���������";break;case "reneg":k="��������������",q="������������� �������"}var s=_dialog({width:480,top:10,head:k+" ��������",content:'<table class="zayav-dogovor"><tr><td class="label">��� �������:<td><input type="text" id="fio" value="'+
DOG.fio+'" /><tr><td class="label">�����:<td><input type="text" id="adres" value="'+DOG.adres+'" /><tr><td class="label">�������:<td>�����:<input type="text" id="pasp_seria" maxlength="8" value="'+DOG.pasp_seria+'" />�����:<input type="text" id="pasp_nomer" maxlength="10" value="'+DOG.pasp_nomer+'" /><tr><td><td><span class="l">��������:</span><input type="text" id="pasp_adres" maxlength="100" value="'+DOG.pasp_adres+'" /><tr><td><td><span class="l">��� �����:</span><input type="text" id="pasp_ovd" maxlength="100" value="'+
DOG.pasp_ovd+'" /><tr><td><td><span class="l">����� �����:</span><input type="text" id="pasp_data" maxlength="100" value="'+DOG.pasp_data+'" /><tr><td class="label">����� ��������:<td><input type="text" id="nomer" maxlength="6" value="'+DOG.nomer+'" /><tr><td class="label">���� ����������:<td><input type="hidden" id="data_create" value="'+(DOG.data_create?DOG.data_create:"")+'" /><tr><td class="label">����� �� ��������:<td><input type="text" id="sum" class="money" maxlength="11" value="'+(DOG.sum?
DOG.sum:"")+'" /> ���.<tr><td class="label">��������� �����:<td><input type="text" id="avans" class="money" maxlength="11" value="'+(DOG.avans?DOG.avans:"")+'" /> ���. <span class="prim">(�� �����������)</span>'+("reneg"==a?'<tr><td class="label">������� ��������������:<td><input type="text" id="reason" />':"")+'<tr><td colspan="2"><a id="cut"></a><tr><td colspan="2"><a id="preview">��������������� �������� ��������</a><form action="'+AJAX_MAIN+'" method="post" id="preview-form" target="_blank"></form></table>',
butSubmit:q,submit:function(){var c=b();c&&(c.op="dogovor_"+a,s.process(),$.post(AJAX_MAIN,c,function(a){a.success?(s.close(),_msg("������� ��������."),document.location.reload()):(s.abort(),h(a.text))},"json"))}});$("#data_create")._calendar({lost:1});$("#cut").click(function(){var a=REGEXP_CENA.test($("#sum").val())?$("#sum").val():0,b=REGEXP_CENA.test($("#avans").val())?$("#avans").val():0,a=a-b;r=_dialog({head:"�������� ������� �� �����",content:'<table class="cut-money"><tr><td class="label">�������� �����:<td><u>'+
a+'</u> ���.<tr id="cut-add"><td><td><a>�������� ����</a><tr><td class="label">�������� �����:<td><b id="cut-itog">'+a+"</b> ���.</table>",butSubmit:"���������",submit:e});l=1;p=[];if(DOG.cut)for(a=DOG.cut.split(","),g=0;g<a.length;g++)b=a[g].split(":"),p.push([b[0],b[1]]),c();else c();d();$("#cut-add a").click(c)}).vkHint({width:180,msg:"������� ���������� ����� ������� �� ������ �� ����� � ������� �� ��� �����������.",delayShow:400,top:-82,left:118});f();$("#preview").click(function(){var a=b("preview");
if(a){a.op="dogovor_preview";var c="",e;for(e in a)c+='<input type="hidden" name="'+e+'" value="'+a[e]+'">';$("#preview-form").html(c).submit()}});$("#reason").autosize()},remindSpisok=function(a){var b=$("#remind").hasClass("y"),c=$("#remind .right ._calendarFilter");a={op:"remind_spisok",day:c.find(".selected").val(),status:$("#status").val(),"private":$("#private").val()};b&&$("#remind").removeClass("y");$.post(AJAX_MAIN,a,function(a){a.success&&($(".remind_spisok").html(a.html),b&&c.html(a.cal))},
"json")},incomeSpisok=function(){var a={op:"income_spisok",day:$(".selected").val(),income_id:$("#income_id").val(),worker_id:window.WORKERS?$("#worker_id").val():0,deleted:$("#deleted").val()};$(".inc-path").addClass("_busy");$.post(AJAX_MAIN,a,function(a){$(".inc-path").removeClass("_busy");a.success&&($(".inc-path").html(a.path),$("#spisok").html(a.html))},"json")},incomeChoiceSum=function(){var a,b=$("._money .choice"),c=0,d=0,e=!0,f=[];for(a=0;a<b.length;a++){var h=b.eq(a);1==h.find("input").val()?
(c++,d+=1*h.parent().find(".sum").html().replace(" ",""),f.push(h.parent().attr("val"))):e=!1}$(".income_choice_sum").html(c?"������"+_end(c,["","�"])+" <b>"+c+"</b> ������"+_end(c,["","�","��"])+" �� ����� <b>"+d+"</b> ���.":"");$("#money_all")._check(e);return{count:c,ids:f.join(),sum:d}},expenseFilter=function(){for(var a=[],b=$("#monthList input"),c=1;12>=c;c++)1==b.eq(c-1).val()&&a.push(c);return{op:"expense_spisok",category:$("#category").val(),worker:$("#worker").val(),invoice_id:$("#invoice_id").val(),
year:$("#year").val(),month:a.join()}},expenseSpisok=function(){$("#mainLinks").addClass("busy");$.post(AJAX_MAIN,expenseFilter(),function(a){$("#mainLinks").removeClass("busy");a.success&&($("#spisok").html(a.html),$("#monthList").html(a.mon))},"json")},salaryCheck=function(){var a=$("._check"),b,c,d="&nbsp;",e=0,f=0,h=[];for(b=0;b<a.length;b++)c=a.eq(b),"salary_all_check"!=c.attr("id")&&0!=c.find("input").val()&&(e++,c=c.parent().parent(),h.push(c.attr("val")),f+=1*c.find(".sum").html());e&&(d=
"������"+_end(e,["�","�"])+" <b>"+e+"</b> �����"+_end(e,["�","�","��"])+' �� ����� <b id="salary-sum">'+f+'</b> ���.<a class="salary-list-create" val="'+h.join()+'">������� ���� ������ �/�</a>');$("#salary-sel").html(d)},salarySpisok=function(){if(!$(".headName").hasClass("_busy")){var a={op:"salary_spisok",worker_id:WORKER_ID,year:$("#year").val(),mon:$("#salmon").val()};$(".headName").addClass("_busy");$.post(AJAX_MAIN,a,function(b){$(".headName").removeClass("_busy");b.success&&(MON=1*a.mon,YEAR=
a.year,$(".headName em").html(MONTH_DEF[MON]+" "+YEAR),$("#spisok").html(b.html),$("#monthList").html(b.month))},"json")}};
$.fn.clientSel=function(a){function b(b){b={op:"client_sel",val:b||"",client_id:a.client_id};c._select("process");$.post(AJAX_MAIN,b,function(b){c._select("cancel");b.success&&(c._select(b.spisok),a.client_id&&(c._select(a.client_id),a.client_id=0))},"json")}var c=$(this);a=$.extend({width:270,add:null,client_id:c.val()||0,func:function(){},funcAdd:function(){}},a);a.add&&(a.add=function(){clientAdd(function(b){var e=[];e.push(b);c._select(e);c._select(b.uid);a.funcAdd(b)})});c._select({width:a.width,
title0:"������� ������� ������ �������...",spisok:[],write:1,nofind:"�������� �� �������",func:a.func,funcAdd:a.add,funcKeyup:b});b();return c};
$.fn.productList=function(a){function b(a){var b=e+f,d=b+"id",h=b+"subid",g=b+"count";m.before('<table id="ptab'+f+'" class="ptab" val="'+f+'"><tr><td class="td"><input type="hidden" id="'+d+'" value="'+(a[0]||0)+'" /><input type="hidden" id="'+h+'" value="'+(a[1]||0)+'" /><td class="td"><input type="text" id="'+g+'" value="'+(a[2]||"")+'" class="count" maxlength="3" /> ��.'+(1<f?'<div class="img_del"></div>':"")+"</table>");var k=$("#ptab"+f);k.find(".img_del").click(function(){k.remove()});$("#"+
d)._select({width:119,title0:"�� �������",spisok:PRODUCT_SPISOK,func:function(a){$("#"+h)._select("remove").val(0);0<a&&PRODUCT_SUB_SPISOK[a]&&c(a,h,g);$("#"+g).val(0<a?1:"").focus()}});c(a[0]||0,h,g);f++}function c(a,b,c){0!=a&&PRODUCT_SUB_SPISOK[a]&&$("#"+b)._select({width:120,title0:"������ �� ������",spisok:PRODUCT_SUB_SPISOK[a],func:function(){$("#"+c).focus()}})}var d=$(this),e=d.attr("id"),f=1,h;if("string"==typeof a&&"get"==a){a=d.find(".ptab");d=[];for(h=0;h<a.length;h++){var g=a.eq(h),k=
e+g.attr("val"),g=$("#"+k+"id").val(),q=$("#"+k+"subid").val(),k=$("#"+k+"count").val();if(0!=g){if(!REGEXP_NUMERIC.test(k)||0==k)return"count_error";d.push(g+":"+q+":"+k)}}return 0==d.length?!1:d.join()}d.html('<div class="_product-list"><a class="add">�������� ����</a></div>');var m=d.find(".add");m.click(b);if("object"==typeof a)for(h=0;h<a.length;h++)b(a[h]);else b([]);return d};
$.fn.zayavExpense=function(a){function b(a){a||(a=[0,"","",0,0,0,0]);var c=d+e,f=c+"cat",h=c+"worker",g=c+"acc",k=c+"mon",q=c+"year",c=c+"list",c='<table id="ptab'+e+'" class="ptab" val="'+e+'"><tr><td><input type="hidden" id="'+f+'" value="'+a[0]+'" /><td class="tddop">'+(a[0]&&ZAYAVEXPENSE_TXT[a[0]]?'<input type="text" class="zrtxt" placeholder="�������� �� �������" tabindex="'+(10*e-1)+'" value="'+a[1]+'" />':"")+(a[0]&&ZAYAVEXPENSE_WORKER[a[0]]?'<input type="hidden" id="'+h+'" value="'+a[1]+'" />':
"")+'<td class="tdsum'+(a[0]?"":" dn")+'"><input type="text" class="zrsum" maxlength="6"'+(a[6]?" disabled":"")+' tabindex="'+10*e+'" value="'+a[2]+'" />���.<td class="tdacc'+(a[0]&&ZAYAVEXPENSE_WORKER[a[0]]&&a[1]?"":" dn")+'"><input type="hidden" id="'+g+'" value="'+a[3]+'" /><td class="tdmon'+(a[3]?"":" dn")+'"><input type="hidden" id="'+k+'" value="'+(a[4]||(new Date).getMonth()+1)+'" /><input type="hidden" id="'+q+'" value="'+(a[5]||(new Date).getFullYear())+'" /><input type="hidden" id="'+c+
'" value="'+a[6]+'" /></table>';s.append(c);var m=$("#ptab"+e),l=m.find(".tddop"),p=m.find(".zrsum"),r=m.find(".tdacc"),t=m.find(".tdmon");$("#"+f)._select({width:120,disabled:a[6],title0:"���������",spisok:ZAYAVEXPENSE_SPISOK,func:function(a){m.find(".tdsum")[(0<a?"remove":"add")+"Class"]("dn");ZAYAVEXPENSE_TXT[a]?(l.html('<input type="text" class="zrtxt" placeholder="�������� �� �������" tabindex="'+(10*e-11)+'" />'),l.find(".zrtxt").focus()):(ZAYAVEXPENSE_WORKER[a]?(l.html('<input type="hidden" id="'+
h+'" />'),$("#"+h)._select({width:150,title0:"���������",spisok:WORKER_SPISOK,func:function(a){p.focus();r[(a?"remove":"add")+"Class"]("dn");$("#"+g)._check(0);t.addClass("dn")}})):l.html(""),p.focus());p.val("");0<a&&!m.next().hasClass("ptab")&&b();r.addClass("dn");$("#"+g)._check(0);t.addClass("dn")}});a[0]&&ZAYAVEXPENSE_WORKER[a[0]]&&$("#"+h)._select({width:150,disabled:a[6],title0:"���������",spisok:WORKER_SPISOK,func:function(a){p.focus();r[(a?"remove":"add")+"Class"]("dn");$("#"+g)._check(0);
t.addClass("dn")}});$("#"+g)._check({disabled:a[6],func:function(a){t[(a?"remove":"add")+"Class"]("dn")}});a[6]||$("#"+g+"_check").vkHint({msg:"���������",top:-58,left:-28,delayShow:1E3});$("#"+k)._dropdown({disabled:a[6],spisok:u});$("#"+q)._dropdown({disabled:a[6],spisok:v});e++}var c=$(this),d=c.attr("id"),e=1,f;if("string"==typeof a&&"get"==a){a=c.find(".ptab");c=[];for(f=0;f<a.length;f++){var h=a.eq(f),g=d+h.attr("val"),k=$("#"+g+"cat").val(),q=h.find(".zrsum").val(),m="",l=0,r=0,p=0;if(0!=k){if(!REGEXP_NUMERIC.test(q)||
0==q)return"sum_error";ZAYAVEXPENSE_TXT[k]?m=h.find(".zrtxt").val():ZAYAVEXPENSE_WORKER[k]&&(m=$("#"+g+"worker").val(),l=$("#"+g+"acc").val(),1==l&&(r=$("#"+g+"mon").val(),p=$("#"+g+"year").val()));c.push(k+":"+m+":"+q+":"+l+":"+r+":"+p+":"+$("#"+g+"list").val())}}return c.join()}c.html('<div class="_zayav-rashod"></div>');var s=c.find("._zayav-rashod"),u=[],v=[];for(f in MONTH_DEF)u.push({uid:f,title:MONTH_DEF[f]});for(f=2014;f<=(new Date).getFullYear();f++)v.push({uid:f,title:f});if("object"==typeof a)for(f=
0;f<a.length;f++)b(a[f]);b();return c};
$(document).ajaxSuccess(function(a,b,c){function d(){var a={op:"pin_enter",pin:$.trim($("#tpin").val())};a.pin?3>a.pin.length?(e("����� ���-���� �� 3 �� 10 ��������"),$("#tpin").focus()):(f.process(),$.post(AJAX_MAIN,a,function(a){a.success?f.close():a.max?location.reload():(f.abort(),e(a.text),$("#tpin").val("").focus())},"json")):(e("�� ��������� ����"),$("#tpin").focus())}function e(a){f.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:-47,left:62,indent:50,show:1,remove:1})}if(b.responseJSON.pin){var f=
_dialog({width:250,head:"������������� ���-����",content:'<table class="setup-tab"><tr><td colspan="2"><div class="_info">������� ����� �������� ���-����. ��������� �������������.</div><tr><td class="label">���-���:<td><input id="tpin" type="password" maxlength="10" /></table>',butSubmit:"�����������",butCancel:"",submit:d});$("#tpin").focus().keyEnter(d)}}).on("change","._attach input",function(){_cookie("_attached",0);for(var a=$(this);!a.hasClass("_attach");)a=a.parent();var b=a.find("form"),c=
a.find(".form"),d=setInterval(function(){var e=_cookie("_attached");0<e&&(clearInterval(d),1==e?(e={op:"attach_get",type:b.find(".type").val(),zayav_id:b.find(".zayav_id").val()},$.post(AJAX_MAIN,e,function(e){c.removeClass("_busy");e.success&&(a.find(".files").html(e.files),b.html(e.form))},"json")):(c.removeClass("_busy"),c.next(".red").remove(),c.after('<div class="red">������������ ����.</div>'),c.next(".red").fadeOut(4E3)))},500);c.addClass("_busy");b.submit()}).on("click","._attach .img_minidel",
function(){var a=$(this),b={op:"attach_del",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success&&(a.prev().remove(),a.remove())},"json")}).on("click",".accrual-del",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();if(!a.hasClass("deleting")){a.addClass("deleting");var b={op:"accrual_del",id:a.attr("val")};$.post(AJAX_MAIN,b,function(c){a.removeClass("deleting");c.success&&(a.after('<tr class="deleted" val="'+b.id+'"><td colspan="4"><div>���������� �������. <a class="accrual-rest">������������</a></div>'),
a.addClass("dn"))},"json")}}).on("click",".accrual-rest",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b={op:"accrual_rest",id:a.attr("val")},c=a.find("div");c.hasClass("_busy")||(c.addClass("_busy"),$.post(AJAX_MAIN,b,function(b){c.removeClass("busy");b.success&&(a.prev().removeClass("dn"),a.remove())},"json"))}).on("click","#client ._next",function(){var a=$(this),b=clientFilter();a.hasClass("busy")||(b.page=a.attr("val"),a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?
a.after(b.spisok).remove():a.removeClass("busy")},"json"))}).on("click",".zayav_add",function(){_dialog({width:370,top:30,head:"�������� ��������� ������",content:'<div class="zayav-add"><div class="item zakaz_add"><b>�����</b>����� ����� ��� ������� ������� ��� ���������.<br />��� ������������� � ������� ����� ����� ����� ��������� � ���������.</div><div class="item zamer_add"><b>�����</b>����� ������ �� �����. ����������� ���� � ����� ������. ������ ������������� �������� � �����������. �������� ����� ����������� �� ���������� ��������.</div><div class="item set_add"><b>���������</b>����� ������ �� ��������� �������.</div>',
butSubmit:""})}).on("click",".zayav_unit",function(){document.location.href=URL+"&p=zayav&d=info&id="+$(this).attr("val")}).on("click","#zayav ._next",function(){var a=$(this);if(!a.hasClass("busy")){var b=zayavFilter();b.page=a.attr("val");a.addClass("busy");$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.spisok).remove():a.removeClass("busy")},"json")}}).on("click","#zayav .filter_clear",function(){$(".find-hide").removeClass("dn");$("#find")._search("clear");$("#status").length&&$("#status").rightLink(0);
$("#product_id")._select(0);$("#zp_expense").length&&($("#zp_expense")._radio(0),$("#zpe_worker_select").addClass("dn"),$("#zpe_worker")._select(0),$("#account")._check(0));zayavSpisok()}).on("click",".zakaz_add",function(){window.CLIENT||(CLIENT={id:0,fio:"",adres:""});var a=_dialog({width:550,top:30,head:"�������� ������ ������",content:'<table class="zayav-add"><tr><td class="label">������:<td><INPUT type="hidden" id="client_id" value="'+CLIENT.id+'"><b>'+CLIENT.fio+'</b><tr><td class="label topi">�������:<td id="product"><tr><td><td><input type="text" id="zakaz_txt" placeholder="���� ������� ���������� ������ �������.." maxlength="300"><tr><td class="label top">�������:\t<td><textarea id="comm"></textarea></table>',
submit:function(){var b,c={op:"zakaz_add",client_id:$("#client_id").val(),product:$("#product").productList("get"),zakaz_txt:$("#zakaz_txt").val(),comm:$("#comm").val()};0==c.client_id?b="�� ������ ������":c.product||c.zakaz_txt?"count_error"==c.product?b="����������� ������� ���������� �������":(a.process(),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("������ �������"),location.href=URL+"&p=zayav&d=info&id="+b.id):a.abort()},"json")):b="���������� ������� ������� ��� ������� ����� �������";
b&&a.bottom.vkHint({msg:'<SPAN class="red">'+b+"</SPAN>",top:-48,left:171,indent:50,show:1,remove:1})}});CLIENT.id||$("#client_id").clientSel({add:1});$("#product").productList();$("#comm").autosize()}).on("click",".zakaz_status",function(){$(this);var a=_dialog({top:30,width:300,head:"��������� ������� ������",content:'<div class="zayav-status">'+(1!=ZAYAV.status?'<div class="st c1" val="1">����� ������� ����������<div class="about">������������� ������ �� ������.</div></div>':"")+'<div class="st c2" val="2">����� ��������<div class="about">��� ���������� �����������, ������� �������� �������.</div><div class="label">�������� ���� ���������� ������:</div><input type="hidden" id="day" value="'+
(ZAYAV.status_day||"")+'"></div>'+(3!=ZAYAV.status?'<div class="st c3" val="3">����� ������<div class="about">������ ������ �� �����-���� �������.</div></div>':"")+"</div>",butSubmit:"",butCancel:"�������"});$("#day")._calendar({lost:1});$(".st").click(function(){var b=$(this),c={op:"zakaz_status",zayav_id:ZAYAV.id,status:b.attr("val"),day:$("#day").val()||""},d=b.parent();d.hasClass("busy")||(d.addClass("busy"),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("������ ��������!"),document.location.reload()):
d.removeClass("busy")},"json"))})}).on("click",".zamer_table",function(){var a=_dialog({width:600,top:10,head:"������� �������",load:1,butSubmit:"",butCancel:"�������"}),b={op:"zamer_table_get",val:$(this).attr("val")||0};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},"json")}).on("click","#zamer-table .ztu",function(){document.location.href=URL+"&p=zayav&d=info&id="+$(this).attr("val")}).on("click","#zamer-table .mon a",function(){var a=$(this),b=a.parent(),a={op:"zamer_table_get",
mon:a.attr("val")};b.hasClass("_busy")||(b.addClass("_busy"),$.post(AJAX_MAIN,a,function(a){a.success?$("#zamer-table").parent().html(a.html):b.removeClass("_busy")},"json"))}).on("click",".zamer_add",function(){function a(a){c.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:185,indent:40,show:1,remove:1})}window.CLIENT||(CLIENT={id:0,fio:"",adres:""});var b=CLIENT.adres,c=_dialog({width:550,top:30,head:"�������� ����� ������ �� �����",content:'<table class="zayav-add"><tr><td class="label">������:<td><INPUT type="hidden" id="client_id" value="'+
CLIENT.id+'"><b>'+CLIENT.fio+'</b><tr><td class="label topi">�������:<td id="product"><tr><td class="label">����� ���������� ������:<td><INPUT type="text" id="adres" maxlength="100" /><INPUT type="hidden" id="homeadres" /><tr><td class="label">���� � ����� ������:<td class="zayav-zamer-dtime"><tr><td class="label">������������ ������:<td><INPUT TYPE="hidden" id="zamer_duration" value="30" /><tr><td class="label top">�������:\t<td><textarea id="comm"></textarea></table>',submit:function(){var b={op:"zamer_add",
client_id:$("#client_id").val(),product:$("#product").productList("get"),adres:$("#adres").val(),zamer_day:$("#zamer_day").val(),zamer_hour:$("#zamer_hour").val(),zamer_min:$("#zamer_min").val(),zamer_duration:$("#zamer_duration").val(),comm:$("#comm").val()};0==b.client_id?a("�� ������ ������"):b.product?"count_error"==b.product?a("����������� ������� ���������� �������"):b.adres?(c.process(),$.post(AJAX_MAIN,b,function(b){b.success?(c.close(),_msg("������ �������"),location.href=URL+"&p=zayav&d=info&id="+
b.id):(c.abort(),a(b.text))},"json")):a("�� ������ �����"):a("�� ������� �������")}});CLIENT.id||$("#client_id").clientSel({add:1,func:function(a,c,f){b=a?f.adres:"";1==$("#homeadres").val()&&$("#adres").val(b)}});$("#product").productList();$("#homeadres")._check({func:function(){$("#adres").val(b)}});$("#homeadres_check").vkHint({msg:"��������� � ������� ����������",top:-75,left:193,indent:60,delayShow:700});zayavZamerDtime({});$("#comm").autosize()}).on("click",".zamer_status",function(){function a(a){e.content.html('<div class="zayav-status"><div class="st c1" val="1">������� ����� �����<div class="about">����� ����� �������� �� ������ �����.</div></div><div class="st c2" val="2">����� ��������<div class="about">����� �������� �������. ������ ����� ���������� �� ���������� ��������.</div></div>'+
(3!=a.status?'<div class="st c3" val="3">������<div class="about">������ ������ �� �����-���� �������.</div></div>':"")+'<table class="zstab"><tr><td class="label">����� �����:<td class="zayav-zamer-dtime"><tr><td class="label">������������:<td><INPUT TYPE="hidden" id="zamer_duration" value="'+a.dur+'" /><a class="zamer_table" val="'+d+'">������� �������</a><tr><td><td><div class="vkButton"><button>���������</button></div></table></div>');zayavZamerDtime(a);$(".st").click(function(){var a=$(this).attr("val");
1==a?($(".st").hide(),$(".zstab").show()):b(a)});$(".zayav-status .vkButton").click(function(){$(this).addClass("busy");b(1)})}function b(a){a={op:"zamer_status",zayav_id:d,status:a,zamer_day:$("#zamer_day").val(),zamer_hour:$("#zamer_hour").val(),zamer_min:$("#zamer_min").val(),zamer_duration:$("#zamer_duration").val()};$.post(AJAX_MAIN,a,function(a){a.success?(e.close(),_msg("������ ��������!"),document.location.reload()):$(".zayav-status .vkButton").removeClass("busy").vkHint({msg:'<SPAN class="red">'+
a.text+"</SPAN>",top:-58,left:-5,indent:40,remove:1,show:1})},"json")}var c=$(this),d="undefined"!=typeof ZAYAV?ZAYAV.id:c.attr("val"),e=_dialog({width:400,top:30,head:"��������� ������� ������",load:1,butSubmit:"",butCancel:"�������"});"undefined"==typeof ZAYAV?$.post(AJAX_MAIN,{op:"zamer_info_get",zayav_id:d},function(b){b.success?a(b):e.loadError()},"json"):a(ZAYAV)}).on("click",".set_add",function(){window.CLIENT||(CLIENT={id:0,fio:"",adres:""});var a=CLIENT.adres,b=_dialog({width:550,top:30,
head:"�������� ����� ������ �� ���������",content:'<table class="zayav-add"><tr><td class="label">������:<td><INPUT type="hidden" id="client_id" value="'+CLIENT.id+'"><b>'+CLIENT.fio+'</b><tr><td class="label topi">�������:<td id="product"><tr><td class="label">����� ���������:<td><INPUT type="text" id="adres" maxlength="100" /><INPUT type="hidden" id="homeadres" /><tr><td class="label top">�������:\t<td><textarea id="comm"></textarea></table>',submit:function(){var a,d={op:"set_add",client_id:$("#client_id").val(),
product:$("#product").productList("get"),adres:$("#adres").val(),comm:$("#comm").val()};0==d.client_id?a="�� ������ ������":d.product?"count_error"==d.product?a="����������� ������� ���������� �������":d.adres?(b.process(),$.post(AJAX_MAIN,d,function(a){a.success?(b.close(),_msg("������ �������"),location.href=URL+"&p=zayav&d=info&id="+a.id):b.abort()},"json")):a="�� ������ �����":a="�� ������� �������";a&&b.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:171,indent:50,show:1,remove:1})}});
CLIENT.id||$("#client_id").clientSel({add:1,func:function(b,d,e){a=b?e.adres:"";1==$("#homeadres").val()&&$("#adres").val(a)},funcAdd:function(b){a=b.adres;1==$("#homeadres").val()&&$("#adres").val(a)}});$("#product").productList();$("#homeadres")._check({func:function(){$("#adres").val(a)}});$("#homeadres_check").vkHint({msg:"��������� � ������� ����������",top:-75,left:193,indent:60,delayShow:700});$("#comm").autosize()}).on("click",".set_status",function(){$(this);var a=_dialog({top:30,width:360,
head:"��������� ������� ���������",content:'<div class="zayav-status">'+(1!=ZAYAV.status?'<div class="st c1" val="1">������� ���������<div class="about">������������� ������ �� ������.</div></div>':"")+'<div class="st c2" val="2">��������� ���������<div class="about">����������� ��������� ���� �������. �� �������� ��������� ������� �� ������ � ��������� ����������.</div><div class="label">�������� ���� ���������� ���������:</div><input type="hidden" id="day" value="'+(ZAYAV.status_day||"")+'"></div>'+
(3!=ZAYAV.status?'<div class="st c3" val="3">������ ��������<div class="about">������ ������ �� �����-���� �������.</div></div>':"")+"</div>",butSubmit:"",butCancel:"�������"});$("#day")._calendar({lost:1});$(".st").click(function(){var b=$(this),c={op:"set_status",zayav_id:ZAYAV.id,status:b.attr("val"),day:$("#day").val()||""},d=b.parent();d.hasClass("busy")||(d.addClass("busy"),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("������ ��������!"),document.location.reload()):d.removeClass("busy")},
"json"))})}).on("click",".refund-del",function(){for(var a=$(this),b=_dialog({top:110,width:250,head:"��������",content:"<CENTER>����������� �������� ��������.</CENTER>",butSubmit:"�������",submit:function(){var c={op:"refund_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?(b.close(),_msg("�������."),$("#income_spisok").html(a.html)):b.abort()},"json")}});"TR"!=a[0].tagName;)a=a.parent()}).on("click",".remind-add",function(){var a=_dialog({top:40,width:420,head:"�������� ������ �����������",
content:'<table class="remind-add-tab">'+(window.ZAYAV?'<tr><td class="label">������:<td><b>'+ZAYAV.head+"</b>":"")+(window.CLIENT?'<tr><td class="label">������:<td>'+CLIENT.fio:"")+'<tr><td class="label top">��������:<td><textarea id="txt"></textarea><tr><td class="label">���� ����������:<TD><INPUT type="hidden" id="day" /><tr><td class="label">������:<TD><INPUT type="hidden" id="add-private" /></table><input type="hidden" id="client_id" value="'+(window.CLIENT?CLIENT.id:0)+'"><input type="hidden" id="zayav_id" value="'+
(window.ZAYAV?ZAYAV.id:0)+'">',submit:function(){var b={op:"remind_add",from:window.ZAYAV?"zayav":window.CLIENT?"client":"",client_id:$("#client_id").val(),zayav_id:$("#zayav_id").val(),txt:$.trim($("#txt").val()),day:$("#day").val(),"private":$("#add-private").val()};b.txt?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?(a.close(),_msg("����������� �������"),$(".remind_spisok").html(b.html)):a.abort()},"json")):(a.bottom.vkHint({msg:'<SPAN class="red">�� ������� ��������</SPAN>',top:-48,left:126,
indent:40,show:1,remove:1}),$("#txt").focus())}});$("#txt").autosize().focus();$("#day")._calendar();$("#add-private")._check();$("#private_check").vkHint({msg:"����������� �������<br />������ ������ ��.",top:-71,left:-11,indent:"left",delayShow:1E3})}).on("click",".remind_status",function(){function a(a){a={op:"remind_status",from:window.ZAYAV?"zayav":window.CLIENT?"client":"",id:b.attr("val"),status:a,day:$("#remind_day").val(),reason:$("#reason").val()};$.post(AJAX_MAIN,a,function(a){a.success&&
(c.close(),_msg("������ ��������!"),$(".remind_spisok").html(a.html))},"json")}var b=$(this),c=_dialog({top:30,head:"��������� ������� �����������",content:'<div class="zayav-status remind-status"><div class="st c1" val="1">������� ������ ����<div class="about">��������� ����������� �� ������ ����.</div></div><div class="st c2" val="2">���������<div class="about">������� ��������� �������.</div></div><div class="st c0" val="0">������<div class="about">������ ����������� �� �����-���� �������.</div></div><table class="zstab"><tr><td class="label">����� ����:<td><input type="hidden" id="remind_day" /><tr><td class="label">�������:<td><input type="text" id="reason" /><tr><td><td><div class="vkButton"><button>���������</button></div></table></div>',
butSubmit:"",butCancel:"�������"});$("#remind_day")._calendar();$(".st").click(function(){var b=$(this).attr("val");1==b?($(".c2,.c0").hide(),$(".zstab").show()):a(b)});$(".remind-status .vkButton").click(function(){$(this).addClass("busy");a(1)})}).on("click",".remind_history",function(){var a={op:"remind_history",id:$(this).attr("val")},b=$("#ru"+a.id+" .hist");b.hasClass("_busy")||(b.html()?b.slideToggle(300):(b.html("&nbsp;").addClass("_busy"),$.post(AJAX_MAIN,a,function(a){b.removeClass("_busy");
a.success&&b.html(a.html)},"json")))}).on("click",".invoice_set",function(){function a(){var a=[];if(f)for(n=0;n<e;n++){var d=g.eq(n).val();if(REGEXP_CENA.test(d))a.push(CASH[n].id+"="+1*d.replace(",","."));else{b("����������� ������� �����");g.eq(n).focus();return}}a={op:"invoice_set",invoice_id:c,sum:f?0:$("#sum").val(),cash:a.join(":")};f||REGEXP_CENA.test(a.sum)?(h.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#cash-spisok").html(a.c),$("#invoice-spisok").html(a.i),h.close(),_msg("������ ����������.")):
h.abort()},"json")):(b("����������� ������� �����"),$("#sum").focus())}function b(a){h.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-48,left:72})}window.CASH||(window.CASH=[]);var c=$(this).attr("val"),d='<table class="_dialog-tab">',e=CASH.length,f="1"==c&&!!e;if(f){for(n=0;n<e;n++)d+='<tr><td class="label">'+CASH[n].name+':<td><INPUT type="text" class="money" maxlength="11" value="'+CASH[n].sum+'"> ���.';d+='<tr><td class="label">���� <b>'+INVOICE_NAME+'</b>:<td><b id="summa">0</b> ���.'}else d+=
'<tr><td class="label">�����:<td><INPUT type="text" class="money" id="sum" maxlength="11"> ���.';var h=_dialog({width:320,head:"��������� ������� ����� �����",content:d+"</table>",butSubmit:"����������",submit:a}),g=h.content.find("input");g.eq(0).focus();g.keyEnter(a);f&&g.keyup(function(){var a=0;for(n=0;n<e;n++){var b=g.eq(n).val();if(REGEXP_CENA.test(b))a+=1*b.replace(",",".");else{a=0;break}}$("#summa").html(a)})}).on("click","#report.invoice .img_note",function(){var a=_dialog({top:20,width:570,
head:"������� �������� �� ������",load:1,butSubmit:"",butCancel:"�������"}),b={op:"invoice_history",invoice_id:$(this).attr("val")};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},"json")}).on("click",".invoice-history ._next",function(){var a=$(this),b={op:"invoice_history",page:a.attr("val"),invoice_id:$("#invoice_history_id").val()};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",
"#money_all_check",function(){for(var a=$(this),b=a.find("input").val();!a.hasClass("_money");)a=a.parent();for(var c=a.find("tr"),a=1;a<c.length;a++)c.eq(a).find("input:first")._check(b)}).on("click",".inc ._check",incomeChoiceSum).on("click",".transfer-show",function(){var a=_dialog({top:20,width:480,head:"�������� ������������� ���������",load:1,butSubmit:"",butCancel:"�������"}),b={op:"transfer_show",ids:$(this).attr("val")};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},
"json")}).on("click",".transfer-spisok .img_del",function(){var a=$(this),b=_dialog({head:"�������� ��������",content:"<center>����������� �������� ��������.</center>",butSubmit:"�������",submit:function(){var c={op:"transfer_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?($("#cash-spisok").html(a.c),$("#invoice-spisok").html(a.i),$(".transfer-spisok").html(a.t),b.close(),_msg("������� �����.")):b.abort()},"json")}})}).on("click",".transfer-spisok ._next",function(){var a=
$(this),b={op:"transfer_spisok",page:a.attr("val")};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".income-confirm",function(){var a=_dialog({top:20,width:480,head:"������������� ��������",load:1,butSubmit:"�����������",submit:function(){var b={op:"income_confirm",ids:incomeChoiceSum().ids};b.ids?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($("#confirm-info").html(b.confirm),$("#cash-spisok").html(b.c),
$("#invoice-spisok").html(b.i),a.close(),_msg("������� ������������.")):a.abort()},"json")):a.bottom.vkHint({msg:'<SPAN class="red">������� �� �������</SPAN>',remove:1,indent:50,show:1,top:-48,left:143})}});$.post(AJAX_MAIN,{op:"income_confirm_get"},function(b){b.success?a.content.html(b.html+'<div class="income_choice_sum"></div>'):a.loadError()},"json")}).on("click",".transfer-confirm",function(){var a=_dialog({top:20,width:520,head:"������������� ���������",load:1,butSubmit:"�����������",submit:function(){for(var b=
a.content.find("._check"),c=[],d=0;d<b.length;d++){var e=b.eq(d).find("input");1==e.val()&&c.push(e.attr("id").split("_")[0])}c.length?(b={op:"transfer_confirm",ids:c.join(),about:$("#about").val()},a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($("#invoice-spisok").html(b.i),a.close(),_msg("�������� ������������.")):a.abort()},"json")):a.bottom.vkHint({msg:'<SPAN class="red">������� �� �������</SPAN>',remove:1,indent:50,show:1,top:-48,left:163})}});$.post(AJAX_MAIN,{op:"transfer_confirm_get"},
function(b){b.success?a.content.html(b.html+'<div class="transfer-about">��������: <input type="text" id="about" /></div>'):a.loadError()},"json")}).on("click",".income-show",function(){var a=_dialog({top:20,width:480,head:"�������� ��������",load:1,butSubmit:"",butCancel:"�������"}),b={op:"income_transfer_show",ids:$(this).attr("val")};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},"json")}).on("click",".income-add",function(){function a(){var a={op:"income_add",from:OPL.from,
type:$("#income_opl").val(),confirm:$("#confirm").val(),sum:$("#sum").val(),zayav_id:$("#zayav_id").val()||0,client_id:OPL.client_id||0,prim:$.trim($("#prim").val())};0==a.type?b("�� ������ ��� �������"):REGEXP_CENA.test(a.sum)&&0!=a.sum?$("#zayav_id").length&&0==a.zayav_id&&!a.prim?(b("���� �� ������� ������, ���������� ������� �����������"),$("#prim").focus()):$("#zayav_id").length||a.prim?(d.process(),$.post(AJAX_MAIN,a,function(a){if(a.success)switch(d.close(),_msg("����� ������� �����!"),OPL.from){case "client":$("#income_spisok").html(a.html);
$(".left:first").html(a.balans);break;case "zayav":$("#income_spisok").html(a.html);break;case "income":incomeSpisok()}else d.abort()},"json")):(b("���������� ������� �����������"),$("#prim").focus()):(b("����������� ������� �����."),$("#sum").focus())}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-48,left:135})}var c='<table class="income-add-tab">'+("income"!=OPL.from?'<tr><td class="label">������:<td>'+OPL.client_fio+'<tr><td class="label">������:<td><input type="hidden" id="zayav_id" value="'+
(OPL.zayav_id?OPL.zayav_id:0)+'">'+(OPL.zayav_id?"<b>"+OPL.zayav_head+"</b>":""):"")+'<tr><td class="label">��� �������:<td><input type="hidden" id="income_opl"><a href="'+URL+'&p=setup&d=income" class="img_edit'+_tooltip("��������� ����� ��������",-85)+'</a><tr class="tr_confirm dn"><td class="label">�������������:<td><input type="hidden" id="confirm"><tr><td class="label">�����:<td><input type="text" id="sum" class="money" maxlength="11"> ���.<tr><td class="label">�����������:<td><input type="text" id="prim" maxlength="100"></table>',
d=_dialog({width:440,head:"�������� �������",content:c,submit:a});$("#sum").focus();$("#sum,#prim").keyEnter(a);OPL.zayav_spisok&&$("#zayav_id")._select({width:210,title0:"�� �������",spisok:OPL.zayav_spisok});$("#income_opl")._select({width:180,title0:"�� ������",spisok:INCOME_SPISOK,func:function(a){$("#sum").focus();$(".tr_confirm")[(INCOME_CONFIRM[a]?"remove":"add")+"Class"]("dn");$("#confirm")._check(0)}});$("#confirm")._check();$("#confirm_check").vkHint({width:210,msg:"���������� �������, ���� ����� ����� ������, �� ��������� ������������� � ��� ����������� �� ����.",
top:-96,left:-100})}).on("click",".income-del",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();if(!a.hasClass("deleting")){a.addClass("deleting");var b={op:"income_del",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){a.removeClass("deleting");b.success&&a.addClass("deleted")},"json")}}).on("click",".income-rest",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b={op:"income_rest",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success&&a.removeClass("deleted")},
"json")}).on("click","#income_next",function(){var a=$(this),b={op:"income_next",page:$(this).attr("val"),limit:$("#money_limit").val(),client_id:$("#money_client_id").val(),zayav_id:$("#money_zayav_id").val(),deleted:$("#money_deleted").val(),income_id:$("#money_income_id").val(),owner_id:$("#money_owner_id").val(),worker_id:$("#money_worker_id").val(),day:$(".selected").val()||""};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},
"json"))}).on("click",".expense #monthList div",expenseSpisok).on("click",".expense ._next",function(){var a=$(this),b=expenseFilter();b.page=a.attr("val");a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".expense .img_del",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();if(!a.hasClass("deleting")){a.addClass("deleting");var b={op:"expense_del",id:a.attr("val")};$.post(AJAX_MAIN,b,
function(b){a.removeClass("deleting");b.success&&a.addClass("deleted")},"json")}}).on("click",".expense .img_rest",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b={op:"expense_rest",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success&&a.removeClass("deleted")},"json")}).on("click",".expense .img_edit",function(){function a(a){c.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:101})}for(var b=$(this);"TR"!=b[0].tagName;)b=b.parent();
var c=_dialog({width:380,head:"�������������� �������",load:1,butSubmit:"���������",submit:function(){var b={id:d,op:"expense_edit",category:1*$("#cat").val(),about:$("#about").val(),worker:$("#work").val(),invoice:1*$("#invoice").val(),sum:$("#sum").val()};b.category||b.about?b.invoice?REGEXP_NUMERIC.test(b.sum)?(c.process(),$.post(AJAX_MAIN,b,function(a){a.success?(c.close(),_msg("������ ������."),expenseSpisok()):c.abort()},"json")):(a("����������� ������� �����."),$("#sum").focus()):a("������� � ������ ����� ������������ ������."):
(a("�������� ��������� ��� ������� ��������."),$("#about").focus())}}),d=b.attr("val");$.post(AJAX_MAIN,{op:"expense_get",id:d},function(a){c.content.html('<table id="expense-add-tab"><tr><td class="label">���������:<td><input type="hidden" id="cat" value="'+a.category+'"><tr class="tr-work '+(EXPENSE_WORKER[a.category]?"":"dn")+'"><td class="label">���������:<td><input type="hidden" id="work" value="'+a.worker+'"><tr><td class="label">��������:<td><input type="text" id="about" maxlength="150" value="'+
a.about+'"><tr><td class="label">�� �����:<td><input type="hidden" id="invoice" value="'+a.invoice+'"><tr><td class="label">�����:<td><input type="text" id="sum" class="money" maxlength="8" value="'+a.sum+'"> ���.</table>');$("#cat")._select({width:180,title0:"�� �������",spisok:EXPENSE_SPISOK,func:function(a){$("#work")._select(0);$(".tr-work")[(EXPENSE_WORKER[a]?"remove":"add")+"Class"]("dn")}});$("#about").focus();$("#work")._select({title0:"�� ������",spisok:WORKER_SPISOK});$("#invoice")._select({title0:"�� ������",
spisok:INVOICE_SPISOK,func:function(){$("#sum").focus()}})},"json")}).on("click","#report_month .yr",function(){$(this).next().toggle()}).on("click",".salary .rate-set",function(){function a(){var a={op:"salary_rate_set",worker:WORKER_ID,sum:$("#sum").val(),day:1*$("#day").val()};REGEXP_CENA.test(a.sum)?!REGEXP_NUMERIC.test(a.day)||!a.day||28<a.day?(b("����������� ������ ����."),$("#day").focus()):(c.process(),$.post(AJAX_MAIN,a,function(b){b.success?(RATE=a.sum,RATE_DAY=a.day,c.close(),_msg("��������� ������ �����������."),
salarySpisok()):c.abort()},"json")):(b("����������� ������� �����."),$("#sum").focus())}function b(a){c.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:74})}var c=_dialog({top:30,width:320,head:"��������� ������ �/� ��� ����������",content:'<div class="_info">����� ��������� ������ ���������� ��������� ����� ����� ������������� ����������� �� ��� ������ ���������� � ����������� ����. ���� ���������� ����� ���� ������ � ���������� �� 1-�� �� 28 �����.</div><table class="salary-tab"><tr><td class="label">�����:<TD><INPUT type="text" id="sum" class="money" maxlength="11" value="'+
(RATE?RATE:"")+'" /> ���.<tr><td class="label">���� ����������:<TD><INPUT type="text" id="day" maxlength="2" value="'+(RATE?RATE_DAY:"")+'" /></table>',butSubmit:"����������",submit:a});$("#sum").focus();$("#sum,#day").keyEnter(a)}).on("click",".salary .up",function(){function a(){var a={op:"salary_up",worker:WORKER_ID,sum:$("#sum").val(),about:$("#about").val(),mon:$("#tabmon").val(),year:$("#tabyear").val()};REGEXP_NUMERIC.test(a.sum)?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?(b.close(),
_msg("���������� �����������."),salarySpisok()):b.abort()},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">����������� ������� �����.</SPAN>',remove:1,indent:40,show:1,top:-47,left:93}),$("#sum").focus())}var b=_dialog({head:"�������� ���������� ��� ����������",content:'<table class="salary-tab"><tr><td class="label">�����:<TD><INPUT type="text" id="sum" class="money" maxlength="8"> ���.<tr><td class="label">��������:<TD><INPUT type="text" id="about" maxlength="50"><tr><td class="label">�����:<td><input type="hidden" id="tabmon" value="'+
MON+'" /> <input type="hidden" id="tabyear" value="'+YEAR+'" /></table>',submit:a});$("#sum").focus();$("#sum,#about").keyEnter(a);$("#tabmon")._select({width:80,spisok:MON_SPISOK});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK})}).on("click",".salary .down",function(){function a(){var a={op:"salary_down",worker:WORKER_ID,invoice:1*$("#invoice").val(),sum:$("#sum").val(),about:$("#about").val(),mon:$("#tabmon").val(),year:$("#tabyear").val()};a.invoice?REGEXP_NUMERIC.test(a.sum)?(d.process(),
$.post(AJAX_MAIN,a,function(a){a.success?(d.close(),_msg("������ �������� �����������."),salarySpisok()):d.abort()},"json")):(b("����������� ������� �����."),$("#sum").focus()):b("������� � ������ ����� ������������ ������.")}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:93})}var c='<table class="salary-tab"><tr><td class="label">�� �����:<TD><input type="hidden" id="invoice"><a href="'+URL+'&p=setup&d=invoice" class="img_edit'+_tooltip("��������� ������",
-56)+'</a><tr><td class="label">�����:<td><input type="text" id="sum" class="money" maxlength="8"> ���.<tr><td class="label">��������:<td><input type="text" id="about" maxlength="100"><tr><td class="label">�����:<td><input type="hidden" id="tabmon" value="'+MON+'" /> <input type="hidden" id="tabyear" value="'+YEAR+'" /></table>',d=_dialog({head:"������ �������� ����������",content:c,submit:a});$("#sum").focus();$("#invoice")._select({title0:"�� ������",spisok:INVOICE_SPISOK,func:function(){$("#sum").focus()}});
$("#sum,#about").keyEnter(a);$("#tabmon")._select({width:80,spisok:MON_SPISOK});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK})}).on("click",".salary .deduct",function(){function a(){var a={op:"salary_deduct",worker:WORKER_ID,sum:$("#sum").val(),about:$("#about").val(),mon:$("#tabmon").val(),year:$("#tabyear").val()};REGEXP_NUMERIC.test(a.sum)?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?(b.close(),_msg("����� ���������."),salarySpisok()):b.abort()},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">����������� ������� �����.</SPAN>',
remove:1,indent:40,show:1,top:-47,left:93}),$("#sum").focus())}var b=_dialog({head:"�������� ������ �� ��������",content:'<table class="salary-tab"><tr><td class="label">�����:<TD><input type="text" id="sum" class="money" maxlength="8"> ���.<tr><td class="label">��������:<TD><input type="text" id="about" maxlength="100"><tr><td class="label">�����:<td><input type="hidden" id="tabmon" value="'+MON+'" /> <input type="hidden" id="tabyear" value="'+YEAR+'" /></table>',submit:a});$("#sum").focus();$("#sum,#about").keyEnter(a);
$("#tabmon")._select({width:80,spisok:MON_SPISOK});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK})}).on("click",".salary .start-set",function(){function a(){var a={op:"salary_start_set",worker:WORKER_ID,sum:$("#sum").val()};REGEXP_CENA.test(a.sum)?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?(b.close(),_msg("��������� ����������."),$("#spisok").html(a.html)):b.abort()},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">����������� ������� �����.</SPAN>',remove:1,indent:40,show:1,top:-47,
left:93}),$("#sum").focus())}var b=_dialog({head:"��������� ������� �� �������� ����������",content:'<table class="salary-tab"><tr><td class="label">�����:<TD><INPUT type="text" id="sum" class="money" maxlength="8"> ���.</table>',butSubmit:"���������",submit:a});$("#sum").focus().keyEnter(a)}).on("click",".salary ._check:not(#salary_all_check)",salaryCheck).on("click",".salary #salary_all_check",function(){var a,b=$(this).find("input").val(),c=$(".ch");for(a=0;a<c.length;a++)c.eq(a).find("._check input:first")._check(b);
salaryCheck()}).on("click",".salary-list-create",function(){function a(){var a={op:"salary_list_create",worker_id:WORKER_ID,ids:b,sum:c,mon:MON,year:YEAR};e.process();$.post(AJAX_MAIN,a,function(a){a.success?(e.close(),_msg("���� ������ �/� ������."),salarySpisok()):e.abort()},"json")}var b=$(this).attr("val");if(b)var c=$("#salary-sum").html(),d='<div class="salary-list-tab"><div class="_info"><b>�������� ����� ������ �/�</b>����� ������������ ����� ������ �/� ��� ���������� ��������� ���������� � ������ ������ ��������������, �� ���� �� ������ ����� ��������.</div><table><tr><td class="label r">���������:<TD>'+
WORKER_ASS[WORKER_ID]+'<tr><td class="label r">������� �������:<TD>'+b.split(",").length+'<tr><td class="label r">�����:<TD>'+c+' ���.<tr><td class="label r">�����:<td>'+MONTH_DEF[MON]+" "+YEAR+'</table><h1><a class="salary-list" val="'+b+'">��������������� ��������</a></h1></div>',e=_dialog({width:330,top:30,head:"�������� ����� ������ �/�",content:d,butSubmit:"������������",submit:a})}).on("click",".salary-list",function(){var a=$(this).attr("val");a&&(location.href=SITE+"/view/salary_list.php?"+
VALUES+"&ids="+a)}).on("click",".salary .zp_del",function(){var a=$(this),b=_dialog({top:110,width:250,head:"�������� �/�",content:"<CENTER>����������� �������� ������.</CENTER>",butSubmit:"�������",submit:function(){var c={op:"expense_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?(b.close(),_msg("�������."),salarySpisok()):b.abort()},"json")}})}).on("click",".salary .ze_del",function(){for(var a=$(this),b=_dialog({top:110,width:250,head:"��������",content:"<CENTER>����������� �������� ������.</CENTER>",
butSubmit:"�������",submit:function(){var c={op:"salary_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?(b.close(),_msg("�������."),salarySpisok()):b.abort()},"json")}});"TR"!=a[0].tagName;)a=a.parent()}).on("click",".salary .list_del",function(){var a=$(this),b=_dialog({top:110,width:250,head:"��������",content:"<CENTER>����������� �������� ����� ������ �/�.</CENTER>",butSubmit:"�������",submit:function(){var c={op:"salary_list_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,
c,function(a){a.success?(b.close(),_msg("�������."),salarySpisok()):b.abort()},"json")}})}).on("mouseenter",".salary .show",function(){$(this).removeClass("show")}).ready(function(){$("#pin-enter").length&&($("#pin").focus().keydown(function(){$(".red").html("&nbsp;")}).keyEnter(pinEnter),$(".vkButton").click(pinEnter));$("#client").length&&(window.cFind=$("#find")._search({width:602,focus:1,enter:1,txt:"������� ������� ������ �������",func:clientSpisok}),$("#buttonCreate").vkHint({msg:'<B>�������� ������ ������� � ����.</B><br /><br />����� �������� �� ��������� �� �������� � ����������� � ������� ��� ���������� ��������.<br /><br />�������� ����� ����� ��������� ��� <A href="'+
URL+'&p=zayav&d=add&back=client">�������� ����� ������</A>.',ugol:"right",width:215,top:-38,left:-250,indent:40,delayShow:1E3}).click(clientAdd),$("#dolg")._check(clientSpisok),$("#dolg_check").vkHint({msg:"<b>������ ���������.</b><br /><br />��������� �������, � ������� ������ ����� 0. ����� � ���������� ������������ ����� ����� �����.",ugol:"right",width:150,top:-6,left:-185,indent:20,delayShow:1E3}),$("#worker")._check(clientSpisok),$("#note")._check(clientSpisok),$("#zayav_cat")._select({width:140,
title0:"����� ������",spisok:[{uid:1,title:"������"},{uid:2,title:"������"},{uid:3,title:"��������"},{uid:4,title:"���������"}],func:clientSpisok}),$("#product_id")._select({width:140,title0:"����� �������",spisok:PRODUCT_SPISOK,func:clientSpisok}));$("#clientInfo").length&&($("#dopLinks .link").click(function(){$("#dopLinks .link").removeClass("sel");$(this).addClass("sel");var a=$(this).attr("val");$(".res").css("display","zayav"==a?"block":"none");$("#zayav_filter").css("display","zayav"==a?"block":
"none");$("#zayav_spisok").css("display","zayav"==a?"block":"none");$("#income_spisok").css("display","money"==a?"block":"none");$(".remind_spisok").css("display","remind"==a?"block":"none");$("#comments").css("display","comm"==a?"block":"none");$("#histories").css("display","hist"==a?"block":"none")}),$(".cedit").click(function(){function a(){var e={op:"client_edit",client_id:CLIENT.id,fio:$("#c-fio").val(),telefon:$("#c-telefon").val(),adres:$("#c-adres").val(),worker_id:$("#worker_id").val(),pasp_seria:$("#pasp_seria").val(),
pasp_nomer:$("#pasp_nomer").val(),pasp_adres:$("#pasp_adres").val(),pasp_ovd:$("#pasp_ovd").val(),pasp_data:$("#pasp_data").val()};e.fio?(c.process(),$.post(AJAX_MAIN,e,function(a){a.success?(a.workers=CLIENT.workers,CLIENT=a,$(".left:first").html(a.html),c.close(),_msg("������ ������� ��������.")):(b(a.text),c.abort())},"json")):(b("�� ������� ��� �������"),$("#c-fio").focus())}function b(a){c.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:-47,left:120,indent:50,show:1,remove:1})}var c=
_dialog({head:"�������������� ������ �������",top:30,width:430,content:'<table class="client-add e"><tr><td class="label">���:<td><input type="text" id="c-fio" maxlength="100" value="'+CLIENT.fio+'"><tr><td class="label">�������:<td><input type="text" id="c-telefon" maxlength="100" value="'+CLIENT.telefon+'"><tr><td class="label">�����:<td><input type="text" id="c-adres" maxlength="100" value="'+CLIENT.adres+'"><tr><td class="label">������ � �����������:<td><input type="hidden" id="worker_id" value="'+
CLIENT.worker_id+'"><tr><td><td><b>���������� ������:</b><tr><td class="label">�����:<td><input type="text" id="pasp_seria" maxlength="8" value="'+CLIENT.pasp_seria+'"><span class="label">�����:</span><input type="text" id="pasp_nomer" maxlength="10" value="'+CLIENT.pasp_nomer+'"><tr><td class="label">��������:<td><input type="text" id="pasp_adres" maxlength="100" value="'+CLIENT.pasp_adres+'"><tr><td class="label">��� �����:<td><input type="text" id="pasp_ovd" maxlength="100" value="'+CLIENT.pasp_ovd+
'"><tr><td class="label">����� �����:<td><input type="text" id="pasp_data" maxlength="100" value="'+CLIENT.pasp_data+'"></table>',butSubmit:"���������",submit:a});$("#worker_id")._select({width:180,title0:"�� ������",spisok:CLIENT.workers});$("#c-fio,#c-telefon,#c-adres,#pasp_seria,#pasp_nomer,#pasp_adres,#pasp_ovd,#pasp_data").keyEnter(a)}),$(".cdel").click(function(){var a=_dialog({top:90,width:300,head:"�������� �������",content:"<center>��������!<br />����� ������� ��� ������ � �������,<br />��� ������, ������� � ������.<br /><b>����������� ��������.</b></center>",
butSubmit:"�������",submit:function(){var b={op:"client_del",id:CLIENT.id};a.process();$.post(AJAX_MAIN,b,function(b){b.success?(a.close(),_msg("������ ������!"),location.href=URL+"&p=client"):a.abort()},"json")}})}));if($("#zayav").length){$("#find")._search({width:153,focus:1,txt:"������� �����...",enter:1,func:zayavFindFast}).vkHint({width:220,msg:"<b>������� �����</b> ������������ ������������ �� ���� ���������� ������. ����������� ����: ����� ��������, ������ ��, �, �, ����� ���������, ��� � �������� �������� � ���������� ����� ������. ������ ������� ������� ������������.",
ugol:"top",indent:"right",delayShow:1E3,top:45,left:384});$("#status").rightLink(zayavSpisok);for(var a=[],b=0;b<PRODUCT_IDS.length;b++){var c=PRODUCT_IDS[b];a.push({uid:c,title:PRODUCT_ASS[c]})}$("#product_id")._select({width:155,title0:"����� �������",spisok:a,func:zayavSpisok});$("#zp_expense")._radio(function(a){$("#zpe_worker_select")[(3==a?"remove":"add")+"Class"]("dn");$("#zpe_worker")._select(0);zayavSpisok()});$("#zpe_worker").length&&$("#zpe_worker")._select({width:155,title0:"��������� �� ������",
spisok:ZPE_WORKER,func:zayavSpisok});$("#zpe_worker_select").addClass("dn");$("#account")._check(zayavSpisok)}$(".zayav-info").length&&($(".zinfo").click(function(){$(this).parent().find(".sel").removeClass("sel");$(this).addClass("sel");$(".zayav-info").removeClass("h")}),$(".hist").click(function(){$(this).parent().find(".sel").removeClass("sel");$(this).addClass("sel");$(".zayav-info").addClass("h")}),$(".dogovor_create").click(dogovorCreate),$(".dogovor_no_require").click(function(){$.post(AJAX_MAIN,
{op:"dogovor_no_require",zayav_id:ZAYAV.id},function(a){a.success&&document.location.reload()},"json")}),$("#dogovor_action")._dropdown({head:"�� ��������",spisok:[{uid:1,title:"��������� �������"},{uid:2,title:'��������� ������ � ��������� "��������� �������"'}],nosel:1,func:function(a){1==a&&dogovorCreate();2==a&&$.post(AJAX_MAIN,{op:"dogovor_require",zayav_id:ZAYAV.id},function(a){a.success&&document.location.reload()},"json")}}),$("#dogovor_reaction")._dropdown({head:"��������",headgrey:1,spisok:[{uid:1,
title:"��������� ������ ��������"},{uid:2,title:"��������������"},{uid:3,title:"�����������"}],nosel:1,func:function(a){1==a&&dogovorCreate("edit")}}),$(".zakaz_edit").click(function(){function a(){var c,e={op:"zakaz_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),zakaz_txt:$("#zakaz_txt").val(),nomer_vg:$("#nomer_vg").val(),nomer_g:$("#nomer_g").val(),nomer_d:$("#nomer_d").val(),nomer_t:$("#nomer_t").val()};e.product||e.zakaz_txt?"count_error"==e.product?c="����������� ������� ���������� �������":
(b.process(),$.post(AJAX_MAIN,e,function(a){a.success?(b.close(),_msg("������ ��������!"),document.location.reload()):b.abort()},"json")):c="���������� ������� ������� ��� ������� ����� �������";c&&b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}var b=_dialog({width:500,top:30,head:ZAYAV.head+" - ��������������",content:'<table class="zayav-info-edit"><tr><td class="label">������:      <td>'+ZAYAV.client_fio+'<tr><td class="label topi">�������:<td id="product"><tr><td><td><input type="text" id="zakaz_txt" placeholder="���� ������� ���������� ������ �������.." maxlength="300" value="'+
ZAYAV.zakaz_txt+'"><tr><td class="label">����� ��:\t<td><INPUT type="text" id="nomer_vg" maxlength="30" value="'+ZAYAV.nomer_vg+'" /><tr><td class="label">����� �: \t<td><INPUT type="text" id="nomer_g" maxlength="30" value="'+ZAYAV.nomer_g+'" /><tr><td class="label">����� �: \t<td><INPUT type="text" id="nomer_d" maxlength="30" value="'+ZAYAV.nomer_d+'" /><tr><td class="label">����� T: \t<td><INPUT type="text" id="nomer_t" maxlength="30" value="'+ZAYAV.nomer_t+'" /></table>',butSubmit:"���������",
submit:a});$("#product").productList(ZAYAV.product);$("#zakaz_txt").keyEnter(a)}),$(".zamer_edit").click(function(){function a(c){b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}var b=_dialog({width:500,top:30,head:ZAYAV.head+" - ��������������",content:'<table class="zayav-info-edit"><tr><td class="label">������:        <td>'+ZAYAV.client_fio+'<tr><td class="label top">�������:\t<td id="product"><tr><td class="label">����� ������:  <td><INPUT type="text" id="adres" maxlength="100" value="'+
ZAYAV.adres+'" /><tr><td class="label">���� � ����� ������:<td class="zayav-zamer-dtime"><tr><td class="label">������������ ������:<td><INPUT TYPE="hidden" id="zamer_duration" value="'+ZAYAV.dur+'" /><a class="zamer_table" val="'+ZAYAV.id+'">������� �������</a></table>',butSubmit:"���������",submit:function(){var c={op:"zamer_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),adres:$("#adres").val(),zamer_day:$("#zamer_day").val(),zamer_hour:$("#zamer_hour").val(),zamer_min:$("#zamer_min").val(),
zamer_duration:$("#zamer_duration").val()};c.product?"count_error"==c.product?a("����������� ������� ���������� �������"):c.adres?(b.process(),$.post(AJAX_MAIN,c,function(c){c.success?(b.close(),_msg("������ ��������!"),document.location.reload()):(b.abort(),a(c.text))},"json")):a("�� ������ �����"):a("�� ������� �������")}});$("#product").productList(ZAYAV.product);zayavZamerDtime(ZAYAV)}),$(".dog_edit").click(function(){var a=_dialog({width:500,top:30,head:"��������������",content:'<table class="zayav-info-edit"><tr><td class="label">������:      <td>'+
ZAYAV.client_fio+'<tr><td class="label top">�������:\t<td id="product"><tr><td class="label">����� ���������:<td><INPUT type="text" id="adres" maxlength="100" value="'+ZAYAV.adres+'" /></table>',butSubmit:"���������",submit:function(){var b,c={op:"dog_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),adres:$("#adres").val()};c.product?"count_error"==c.product?b="����������� ������� ���������� �������":c.adres?(a.process(),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("������ ��������!"),
document.location.reload()):a.abort()},"json")):b="�� ������ �����":b="�� ������� �������";b&&a.bottom.vkHint({msg:'<SPAN class="red">'+b+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}});$("#product").productList(ZAYAV.product)}),$(".set_edit").click(function(){function a(){var c,e={op:"set_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),adres:$("#adres").val(),nomer_vg:$("#nomer_vg").val(),nomer_g:$("#nomer_g").val(),nomer_d:$("#nomer_d").val(),nomer_t:$("#nomer_t").val()};
e.product?"count_error"==e.product?c="����������� ������� ���������� �������":e.adres?(b.process(),$.post(AJAX_MAIN,e,function(a){a.success?(b.close(),_msg("������ ��������!"),document.location.reload()):b.abort()},"json")):c="�� ������ �����":c="�� ������� �������";c&&b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}var b=_dialog({width:500,top:30,head:ZAYAV.head+" - ��������������",content:'<table class="zayav-info-edit"><tr><td class="label">������:      <td>'+
ZAYAV.client_fio+'<tr><td class="label top">�������:\t<td id="product"><tr><td class="label">����� ���������:<td><INPUT type="text" id="adres" maxlength="100" value="'+ZAYAV.adres+'" /><tr><td class="label">����� ��:\t   <td><INPUT type="text" id="nomer_vg" maxlength="30" value="'+ZAYAV.nomer_vg+'" /><tr><td class="label">����� �: \t   <td><INPUT type="text" id="nomer_g" maxlength="30" value="'+ZAYAV.nomer_g+'" /><tr><td class="label">����� �: \t   <td><INPUT type="text" id="nomer_d" maxlength="30" value="'+
ZAYAV.nomer_d+'" /><tr><td class="label">����� T: \t   <td><INPUT type="text" id="nomer_t" maxlength="30" value="'+ZAYAV.nomer_t+'" /></table>',butSubmit:"���������",submit:a});$("#product").productList(ZAYAV.product);$("#adres,#nomer_vg,#nomer_g,#nomer_d,#nomer_t").keyEnter(a)}),$(".acc-add").click(function(){function a(){var c,e={op:"accrual_add",zayav_id:ZAYAV.id,sum:$("#sum").val(),prim:$("#prim").val()};REGEXP_CENA.test(e.sum)?(b.process(),$.post(AJAX_MAIN,e,function(a){b.abort();a.success&&
(b.close(),_msg("���������� ������� �����������."),$("#income_spisok").html(a.html))},"json")):(c="����������� ������� �����.",$("#sum").focus());c&&b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-48,left:123,indent:40,remove:1,show:1})}var b=_dialog({width:420,head:"����������",content:'<table class="accrual-add"><tr><td class="label">�����: <td><input type="text" id="sum" class="money" maxlength="11" /> ���.<tr><td class="label">����������:<em>(�� �����������)</em><td><input type="text" id="prim" maxlength="100" /></table>',
submit:a});$("#sum").focus();$("#sum,#prim").keyEnter(a)}),$(".delete").click(function(){var a=_dialog({top:110,width:250,head:"�������� ������",content:"<CENTER>����������� �������� ������.</CENTER>",butSubmit:"�������",submit:function(){var b={op:"zayav_delete",zayav_id:ZAYAV.id};a.process();$.post(AJAX_MAIN,b,function(a){a.success&&(location.href=URL+"&p=client&d=info&id="+a.client_id)},"json")}})}),$(".expense-edit").click(function(){var a=_dialog({width:510,top:30,head:"��������� �������� ������",
content:'<table class="zayav-expense-edit"><tr><td class="label">������: <td><b>'+ZAYAV.head+'</b><tr><td class="label topi">�������:<td><tr><td colspan="2" id="zrs"></table>',butSubmit:"���������",submit:function(){var b={op:"zayav_expense_edit",zayav_id:ZAYAV.id,rashod:$("#zrs").zayavExpense("get")};"sum_error"==b.rashod?a.bottom.vkHint({msg:'<SPAN class="red">����������� ������� �����</SPAN>',top:-47,left:167,indent:40,show:1,remove:1}):(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($(".zrashod").html(b.html),
ZAYAV.rashod=b.array,a.close(),_msg("���������.")):a.abort()},"json"))}});$("#zrs").zayavExpense(ZAYAV.rashod)}),$(".zakaz-to-set").click(function(){function a(){var c={op:"zakaz_to_set",zayav_id:ZAYAV.id,adres:$("#adres").val()};c.adres?(b.process(),$.post(AJAX_MAIN,c,function(a){b.abort();a.success&&(b.close(),_msg("���������."),document.location.reload())},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">�� ������ ����� ���������</SPAN>',top:-48,left:113,indent:40,remove:1,show:1}),$("#adres").focus())}
var b=_dialog({width:400,head:"������� ������ � ���������",content:'<table class="_dialog-tab"><tr><td class="label">������:<td>'+ZAYAV.client_fio+'<tr><td class="label">����� ���������:<td><INPUT type="text" id="adres" maxlength="100" value="'+ZAYAV.adres+'" /><INPUT type="hidden" id="homeadres" /></table>',butSubmit:"���������",submit:a});$("#adres").focus().keyEnter(a);$("#homeadres")._check({func:function(){$("#adres").val(ZAYAV.client_adres)}});$("#homeadres_check").vkHint({msg:"��������� � ������� ���������� �������",
top:-75,left:163,indent:60,delayShow:400})}),$(".set-to-zakaz").click(function(){var a=_dialog({head:"������� ��������� � ������",content:'<table class="_dialog-tab"><tr><td class="label">������:<td><b>'+ZAYAV.head+'</b><tr><td class="label">������:<td>'+ZAYAV.client_fio+"</table>",butSubmit:"���������",submit:function(){var b={op:"set_to_zakaz",zayav_id:ZAYAV.id};a.process();$.post(AJAX_MAIN,b,function(b){b.success?(a.close(),_msg("���������."),location.reload()):a.abort()},"json")}})}),$(".refund-add").click(function(){function a(){var c=
{op:"refund_add",zayav_id:ZAYAV.id,invoice_id:1*$("#invoice_id").val(),sum:$("#sum").val(),prim:$.trim($("#prim").val())};c.invoice_id?REGEXP_CENA.test(c.sum)?(d.process(),$.post(AJAX_MAIN,c,function(a){d.abort();a.success&&(d.close(),_msg("������� ������� ���������."),$("#income_spisok").html(a.html))},"json")):(b("����������� ������� �����"),$("#sum").focus()):b("�� ������ ����")}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:100,indent:40,remove:1,show:1})}var c=
'<table class="refund-add-tab"><tr><td class="label">������:<td>'+OPL.client_fio+'<tr><td class="label">�� �����:<TD><INPUT type="hidden" id="invoice_id"><a href="'+URL+'&p=setup&d=invoice" class="img_edit'+_tooltip("��������� ������",-56)+'</a><tr><td class="label">�����:<td><input type="text" id="sum" class="money" maxlength="11" /> ���.<span id="isum"></span><tr><td class="label">�����������:<td><input type="text" id="prim" maxlength="100" /></table>',d=_dialog({width:370,head:"�������",content:c,
submit:a});$("#sum").focus();$("#sum,#prim").keyEnter(a);$("#invoice_id")._select({title0:"�� ������",spisok:INVOICE_SPISOK,func:function(a){$("#sum").focus();$("#isum").html(ZAYAV.isum[a]?"max: <b>"+ZAYAV.isum[a]+"</b>":"")}})}));$("#remind").length&&($(".goyear").click(function(){$("#remind").addClass("y")}),window._calendarFilter=remindSpisok,$("#status")._radio(remindSpisok),$("#private")._check(remindSpisok));$("#report.history").length&&($("#viewer_id_add")._select({width:160,title0:"��� ����������",
spisok:WORKERS,func:_history}),$("#action")._select({width:160,title0:"����� ���������",spisok:HISTORY_GROUP,func:_history}));$("#report.income").length&&(window._calendarFilter=incomeSpisok,$("#income_id")._select({width:160,title0:"����� �������",spisok:INCOME_SPISOK,func:incomeSpisok}),window.WORKERS&&$("#worker_id")._select({width:160,title0:"��� ����������",spisok:WORKERS,func:incomeSpisok}),$("#deleted")._check(incomeSpisok));$("#report.expense").length&&($(".add").click(function(){function a(){var c=
{op:"expense_add",category:1*$("#cat").val(),about:$("#about").val(),worker:$("#work").val(),invoice:1*$("#invoice").val(),sum:$("#sum").val(),mon:$("#tabmon").val(),year:$("#tabyear").val()};c.category||c.about?c.invoice?REGEXP_CENA.test(c.sum)&&0!=c.sum?(d.process(),$.post(AJAX_MAIN,c,function(a){a.success?(d.close(),_msg("����� ������ �����."),expenseSpisok()):d.abort()},"json")):(b("����������� ������� �����."),$("#sum").focus()):b("������� � ������ ����� ������������ ������."):(b("�������� ��������� ��� ������� ��������."),
$("#about").focus())}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:101})}var c='<table id="expense-add-tab"><tr><td class="label">���������:<TD><INPUT type="hidden" id="cat"><a href="'+URL+'&p=setup&d=expense" class="img_edit'+_tooltip("��������� ��������� ��������",-95)+'</a><tr class="tr-work dn"><td class="label">���������:<TD><INPUT type="hidden" id="work"><tr class="tr-work dn"><td class="label">�����:<td><input type="hidden" id="tabmon" value="'+
((new Date).getMonth()+1)+'" /> <input type="hidden" id="tabyear" value="'+(new Date).getFullYear()+'" /><tr><td class="label">��������:<TD><INPUT type="text" id="about" maxlength="100"><tr><td class="label">�� �����:<TD><INPUT type="hidden" id="invoice"><a href="'+URL+'&p=setup&d=invoice" class="img_edit'+_tooltip("��������� ������",-56)+'</a><tr><td class="label">�����:<TD><INPUT type="text" id="sum" class="money" maxlength="11"> ���.</table>',d=_dialog({width:380,head:"�������� �������",content:c,
submit:a});$("#cat")._select({width:180,title0:"�� �������",spisok:EXPENSE_SPISOK,func:function(a){$("#work")._select(0);$(".tr-work")[(EXPENSE_WORKER[a]?"remove":"add")+"Class"]("dn")}});$("#about").focus();$("#work")._select({title0:"�� ������",spisok:WORKER_SPISOK});$("#invoice")._select({title0:"�� ������",spisok:INVOICE_SPISOK,func:function(){$("#sum").focus()}});$("#sum,#about").keyEnter(a);$("#tabmon")._select({width:80,spisok:MON_SPISOK});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK})}),
$("#category")._select({width:160,title0:"����� ���������",spisok:EXPENSE_SPISOK,func:expenseSpisok}),$("#worker")._select({width:160,title0:"��� ����������",spisok:WORKERS,func:expenseSpisok}),$("#invoice_id")._radio(expenseSpisok),$("#year").years({func:expenseSpisok,center:function(){var a=$("#monthList input"),c=0;for(b=1;12>=b;b++)if(0==a.eq(b-1).val()){c=1;break}for(b=1;12>=b;b++)$("#c"+b)._check(c);expenseSpisok()}}));$("#report.invoice").length&&$(".transfer").click(function(){function a(){var b=
{op:"invoice_transfer",from:1*$("#from").val(),to:1*$("#to").val(),sum:$("#sum").val(),ids:$("#ids").val()};b.from?b.to?b.from==b.to?c("�������� ������ ����"):REGEXP_CENA.test(b.sum)&&0!=b.sum?(d.process(),$.post(AJAX_MAIN,b,function(a){a.success?($("#cash-spisok").html(a.c),$("#invoice-spisok").html(a.i),$(".transfer-spisok").html(a.t),d.close(),_msg("������� ���������.")):d.abort()},"json")):(c("����������� ������� �����"),$("#sum").focus()):c("�������� ����-����������"):c("�������� ����-�����������")}
function c(a,b){d.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:b?-95:-47,left:b?197:92,indent:50,show:1,remove:1})}$(this);var d=_dialog({width:380,head:"������� ����� �������",content:'<table class="invoice-transfer"><tr><td class="label">�� �����:<td><input type="hidden" id="from" /><tr><td class="label">�� ����:<td><input type="hidden" id="to" /><tr><td class="label">�����:<td><input type="text" id="sum" class="money" /> ���. <a class="income-choice">������� �������</a><input type="hidden" id="ids" /></table>',
butSubmit:"���������",submit:a});if(window.CASH_SPISOK&&!window.CSMOVE){for(b=0;b<INVOICE_SPISOK.length;b++)1!=INVOICE_SPISOK[b].uid&&CASH_SPISOK.push(INVOICE_SPISOK[b]);INVOICE_SPISOK=CASH_SPISOK;window.CSMOVE=1}$("#from")._select({width:250,title0:"�� ������",spisok:INVOICE_SPISOK,func:function(a){$(".income-choice").html("������� �������");$("#ids").val("");$("#sum").val("").attr("readonly",SELMONEY[a]?!0:!1)}});$("#to")._select({width:250,title0:"�� ������",spisok:INVOICE_SPISOK});$("#sum").keyEnter(a);
$("#sum").keyup(function(){$("#ids").val()&&($(".income-choice").html("������� �������"),$("#ids").val(""),$("#sum").val(""))});$(".income-choice").click(function(){function a(){var c=incomeChoiceSum();$("#ids").val(c.ids);$(".income-choice").html(c.count+" ������"+_end(c.count,["","�","��"]));$("#sum").val(c.sum);b.close()}if(0==$("#from").val())c("�� ������ ����-�����������",1);else{var b=_dialog({top:20,width:480,head:"����� �������� ��� ��������",load:1,butSubmit:"������",submit:a}),d={op:"income_choice",
owner_id:$("#from").val(),ids:$("#ids").val()};$.post(AJAX_MAIN,d,function(a){a.success?(b.content.html(a.html+'<div class="income_choice_sum"></div>'),incomeChoiceSum()):b.loadError()},"json")}})});if($("#report.salary").length)if($("#uall").length){$("#uall")._check(function(a){var c=$("._check");for(b=1;b<c.length;b++)c.eq(b).find("input")._check(a)});var a=[],d;for(d in MONTH_DEF)a.push({uid:d,title:MONTH_DEF[d]});$("#rmon")._select({width:100,spisok:a});$("#ryear")._select({width:60,spisok:YEARS});
$(".vkButton").click(function(){var a=$(this),c=$("._check"),d=[];for(b=1;b<c.length;b++){var g=c.eq(b).find("input");1==g.val()&&d.push(g.attr("id").split("u")[1])}(c=d.join())?document.location.href=SITE+"/view/salary_report.php?"+VALUES+"&ids="+c+"&mon="+$("#rmon").val()+"&year="+$("#ryear").val():a.vkHint({msg:'<span class="red">�� ������� ����������</span>',top:-57,left:7,indent:50,show:1,remove:1})})}else $("#year").years({func:salarySpisok}),$("#salmon")._radio({func:salarySpisok})});
