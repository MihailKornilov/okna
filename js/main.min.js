var hashLoc,hashSet=function(a){if(a||a.p){hashLoc=a.p;switch(a.p){case "client":"info"==a.d&&(hashLoc+="_"+a.id);break;case "zayav":"info"==a.d?hashLoc+="_"+a.id:"add"==a.d&&(hashLoc+="_add"+(REGEXP_NUMERIC.test(a.id)?"_"+a.id:""));break;default:a.d&&(hashLoc+="_"+a.d,a.d1&&(hashLoc+="_"+a.d1))}VK.callMethod("setLocation",hashLoc)}},pinEnter=function(){var a={op:"pin_enter",pin:$.trim($("#pin").val())};a.pin&&2<a.pin.length&&($(".vkButton").addClass("busy"),$.post(AJAX_MAIN,a,function(a){a.success?
location.href=URL+"&p="+_cookie("p")+"&d="+_cookie("d")+"&id="+_cookie("id"):($(".vkButton").removeClass("busy"),$("#pin").val("").focus(),$(".red").html(a.text))},"json"))},clientAdd=function(a){function b(){var b={op:"client_add",fio:$("#c-fio").val(),telefon:$("#c-telefon").val(),adres:$("#c-adres").val(),pasp_seria:$("#pasp_seria").val(),pasp_nomer:$("#pasp_nomer").val(),pasp_adres:$("#pasp_adres").val(),pasp_ovd:$("#pasp_ovd").val(),pasp_data:$("#pasp_data").val()};b.fio?(c.process(),$.post(AJAX_MAIN,
b,function(b){b.success?(c.close(),_msg("Новый клиент внесён."),"function"==typeof a?a(b):document.location.href=URL+"&p=client&d=info&id="+b.uid):c.abort()},"json")):(c.bottom.vkHint({msg:'<SPAN class="red">Не указано имя клиента.</SPAN>',top:-47,left:103,indent:40,show:1,remove:1}),$("#c-fio").focus())}var c=_dialog({width:380,head:"Добавление нoвого клиента",content:'<table class="client-add"><tr><td class="label">Имя:<td><input type="text" id="c-fio" maxlength="100"><tr><td class="label">Телефон:<td><input type="text" id="c-telefon" maxlength="100"><tr><td class="label">Адрес:<td><input type="text" id="c-adres" maxlength="100"><tr class="tr_pasp"><td colspan="2"><a>Заполнить паспортные данные</a><tr class="dn"><td><td><b>Паспортные данные:</b><tr class="dn"><td class="label">Серия:<td><input type="text" id="pasp_seria" maxlength="8"><span class="label">Номер:</span><input type="text" id="pasp_nomer" maxlength="10"><tr class="dn"><td class="label">Прописка:<td><input type="text" id="pasp_adres" maxlength="100"><tr class="dn"><td class="label">Кем выдан:<td><input type="text" id="pasp_ovd" maxlength="100"><tr class="dn"><td class="label">Когда выдан:<td><input type="text" id="pasp_data" maxlength="100"></table>',
submit:b});$("#c-fio").focus();$("#c-fio,#c-telefon,#c-adres").keyEnter(b);$(".tr_pasp a").click(function(){$(".tr_pasp").remove();$(".client-add .dn").removeClass("dn");$("#pasp_seria").focus()})},clientFilter=function(){var a={op:"client_spisok",find:$.trim($("#find")._search("val")),dolg:$("#dolg").val(),worker:$("#worker").val(),note:$("#note").val(),zayav_cat:$("#zayav_cat").val(),product_id:$("#product_id").val()},b="";$(".filter")[a.find?"hide":"show"]();a.find?b+=".find="+escape(a.find):(0<
a.dolg&&(b+=".dolg="+a.dolg),0<a.worker&&(b+=".worker="+a.worker),0<a.note&&(b+=".note="+a.note),0<a.zayav_cat&&(b+=".zayav_cat="+a.zayav_cat),0<a.product_id&&(b+=".product_id="+a.product_id));VK.callMethod("setLocation",hashLoc+b);_cookie("client_find",escape(a.find));_cookie("client_worker",a.worker);_cookie("client_dolg",a.dolg);_cookie("client_note",a.note);_cookie("client_zayav_cat",a.zayav_cat);_cookie("client_product_id",a.product_id);return a},clientSpisok=function(){var a=$(".result");a.hasClass("busy")||
(a.addClass("busy"),$.post(AJAX_MAIN,clientFilter(),function(b){a.removeClass("busy");b.success&&(a.html(b.result),$(".left").html(b.spisok))},"json"))},zayavZamerDtime=function(a){a=$.extend({day:"",hour:10,min:0},a);a='<table><tr><td><INPUT TYPE="hidden" id="zamer_day" value="'+a.day+'" /><td><INPUT TYPE="hidden" id="zamer_hour" value="'+a.hour+'" /><td> : <td><INPUT TYPE="hidden" id="zamer_min" value="'+a.min+'" /></table>';$(".zayav-zamer-dtime").html(a);$("#zamer_day")._calendar();$("#zamer_hour")._select({width:40,
spisok:ZAMER_HOUR});$("#zamer_min")._select({width:40,spisok:ZAMER_MIN});$("#zamer_duration")._select({width:100,spisok:ZAMER_DURATION})},zayavFindFast=function(){var a={op:"zayav_findfast",find:$.trim($("#find input").val())};$(".find-hide")[(a.find?"add":"remove")+"Class"]("dn");a.find?($("#mainLinks").addClass("busy"),$.post(AJAX_MAIN,a,function(a){$("#mainLinks").removeClass("busy");a.success&&($("#zayav .result").html(a.result),$("#zayav #spisok").html(a.spisok))},"json")):zayavSpisok()},zayavFilter=
function(){return{op:"zayav_spisok",category:$("#zayav").attr("val"),product:$("#product_id").val(),status:$("#status").length?$("#status").val():0,zpe:$("#zp_expense").length?$("#zp_expense").val():0,zpe_worker:$("#zpe_worker").length?$("#zpe_worker").val():0,account:$("#account").length?$("#account").val():0}},zayavSpisok=function(){$("#mainLinks").addClass("busy");$.post(AJAX_MAIN,zayavFilter(),function(a){$("#mainLinks").removeClass("busy");a.success&&($("#zayav .result").html(a.result),$("#zayav #spisok").html(a.spisok))},
"json")},dogovorCreate=function(a){function b(b){var c={id:DOG.id,zayav_id:ZAYAV.id,fio:$("#fio").val(),adres:$("#adres").val(),pasp_seria:$("#pasp_seria").val(),pasp_nomer:$("#pasp_nomer").val(),pasp_adres:$("#pasp_adres").val(),pasp_ovd:$("#pasp_ovd").val(),pasp_data:$("#pasp_data").val(),nomer:$("#nomer").val(),data_create:$("#data_create").val(),sum:$("#sum").val(),avans:$("#avans").val(),cut:DOG.cut,reason:"reneg"==a?$("#reason").val():""};if(c.fio)if(REGEXP_NUMERIC.test(c.nomer)&&0!=c.nomer)if(REGEXP_CENA.test(c.sum)&&
0!=c.sum)if(c.avans&&!REGEXP_CENA.test(c.avans))f("Некорректно указан авансовый платёж","avans",b);else{if("reneg"!=a||c.reason)return c;f("Не указана причина перезаключения договора","reason",b)}else f("Некорректно указана сумма по договору","sum",b);else f("Некорректно указан номер договора","nomer",b);else f("Не указано Фио клиента","fio",b);return!1}function c(){var a=q[p-1],a='<tr><td class="label">'+p+'-й платёж:<td><input type="text" class="cutsum" id="i'+p+'" maxlength="7" value="'+(a?a[0]:
"")+'"> руб. <input type="hidden" id="d'+p+'" value="'+(a?a[1]:"")+'">';$("#cut-add").before(a);1!=p||q[0]||$("#i1").val($("#cut-itog").html());$("#i"+p).focus().keyup(d);$("#d"+p)._calendar();p++}function d(){var a=$(".cutsum"),b=0,c,e=[];for(h=0;h<a.length;h++)if((c=$.trim(a.eq(h).val()))&&0!=c){if(!REGEXP_CENA.test(c)){b=!1;break}b+=1*c;e.push(1*c+":"+a.eq(h).next().find("input").val())}!1===b&&(b=Math.round(100*b)/100);$("#cut-itog").html(b);return!1===b?"error":e}function e(){var a=d();"error"==
a?s.bottom.vkHint({msg:'<span class="red">Некорректно заполнено поле платежа</span>',top:-47,left:84,indent:50,show:1,remove:1}):(DOG.cut=a.join(),g(),s.close())}function g(){var a=DOG.cut?DOG.cut.split(",").length:0;$("#cut").html(a?"Указан"+_end(a,["а","ы"])+" дат"+_end(a,["а","ы"])+" для "+a+_end(a,["-го","-х","-и"])+" платеж"+_end(a,["а","ей"])+'. <u>Изменить</u><div class="img_del'+_tooltip("Отменить разбивку",-61)+"</div>":m);a&&$("#cut .img_del").click(function(a){a.stopPropagation();DOG.cut=
"";$("#cut").html(m)})}function f(a,b,c){r.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:c?-86:-47,left:c?173:142,indent:50,show:1,remove:1});b&&$("#"+b).focus()}var h,k="Заключение",l="Заключить договор",m="Указать даты очередных платежей",p,s,q;switch(a){default:a="create";case "create":break;case "edit":k="Изменение данных";l="Применить";break;case "reneg":k="Перезаключение",l="Перезаключить договор"}var r=_dialog({width:480,top:10,head:k+" договора",content:'<table class="zayav-dogovor"><tr><td class="label">Фио клиента:<td><input type="text" id="fio" value="'+
DOG.fio+'" /><tr><td class="label">Адрес:<td><input type="text" id="adres" value="'+DOG.adres+'" /><tr><td class="label">Паспорт:<td>Серия:<input type="text" id="pasp_seria" maxlength="8" value="'+DOG.pasp_seria+'" />Номер:<input type="text" id="pasp_nomer" maxlength="10" value="'+DOG.pasp_nomer+'" /><tr><td><td><span class="l">Прописка:</span><input type="text" id="pasp_adres" maxlength="100" value="'+DOG.pasp_adres+'" /><tr><td><td><span class="l">Кем выдан:</span><input type="text" id="pasp_ovd" maxlength="100" value="'+
DOG.pasp_ovd+'" /><tr><td><td><span class="l">Когда выдан:</span><input type="text" id="pasp_data" maxlength="100" value="'+DOG.pasp_data+'" /><tr><td class="label">Номер договора:<td><input type="text" id="nomer" maxlength="6" value="'+DOG.nomer+'" /><tr><td class="label">Дата заключения:<td><input type="hidden" id="data_create" value="'+(DOG.data_create?DOG.data_create:"")+'" /><tr><td class="label">Сумма по договору:<td><input type="text" id="sum" class="money" maxlength="11" value="'+(DOG.sum?
DOG.sum:"")+'" /> руб.<tr><td class="label">Авансовый платёж:<td><input type="text" id="avans" class="money" maxlength="11" value="'+(DOG.avans?DOG.avans:"")+'"'+(DOG.avans_owner?"":" disabled")+' /> руб. <span class="prim">(не обязательно)</span>'+("reneg"==a?'<tr><td class="label">Причина перезаключения:<td><input type="text" id="reason" />':"")+'<tr><td colspan="2"><a id="cut"></a><tr><td colspan="2"><a id="preview">Предварительный просмотр договора</a><form action="'+AJAX_MAIN+'" method="post" id="preview-form" target="_blank"></form></table>',
butSubmit:l,submit:function(){var c=b();c&&(c.op="dogovor_"+a,r.process(),$.post(AJAX_MAIN,c,function(a){a.success?(r.close(),_msg("Договор заключен."),document.location.reload()):(r.abort(),f(a.text))},"json"))}});$("#data_create")._calendar({lost:1});$("#cut").click(function(){var a=REGEXP_CENA.test($("#sum").val())?$("#sum").val():0,b=REGEXP_CENA.test($("#avans").val())?$("#avans").val():0,a=a-b;s=_dialog({head:"Разбивка платежа на части",content:'<table class="cut-money"><tr><td class="label">Исходная сумма:<td><u>'+
a+'</u> руб.<tr id="cut-add"><td><td><a>Добавить поле</a><tr><td class="label">Итоговая сумма:<td><b id="cut-itog">'+a+"</b> руб.</table>",butSubmit:"Применить",submit:e});p=1;q=[];if(DOG.cut)for(a=DOG.cut.split(","),h=0;h<a.length;h++)b=a[h].split(":"),q.push([b[0],b[1]]),c();else c();d();$("#cut-add a").click(c)}).vkHint({width:180,msg:"Разбить оставшуюся сумму платежа по заявке на части и создать по ним напоминания.",delayShow:400,top:-82,left:118});g();$("#preview").click(function(){var a=b("preview");
if(a){a.op="dogovor_preview";var c="",e;for(e in a)c+='<input type="hidden" name="'+e+'" value="'+a[e]+'">';$("#preview-form").html(c).submit()}});$("#reason").autosize()},dogovorDestroy=function(){var a=_dialog({head:"Расторжение договора",butSubmit:"Применить",content:'<div class="_info">При расторжении договора авансовый платёж возвращается клиенту в виде возврата наличным платежём полной суммой. Начисление по договору удаляется.</div>Договор <b>№'+DOG.nomer+"</b> будет расторгнут.<br />"+(DOG.avans?
"Авансовый платёж в сумме <b>"+DOG.avans+"</b> руб. будет возвращён клиенту.":""),submit:function(){var b={op:"dogovor_terminate",zayav_id:ZAYAV.id};a.process();$.post(AJAX_MAIN,b,function(b){b.success?(a.close(),_msg("Договор был расторгнут."),location.reload()):a.abort()},"json")}})},zayavInfoMoneyUpdate=function(){$.post(AJAX_MAIN,{op:"zayav_info_money_update",zayav_id:ZAYAV.id},function(a){a.success&&($("b.acc").html(a.acc),$(".acc_tr")[(a.acc?"remove":"add")+"Class"]("dn"),$("b.opl").html(a.opl),
$(".opl_tr")[(a.opl?"remove":"add")+"Class"]("dn"),$(".dopl")[(a.dolg?"remove":"add")+"Class"]("dn").html((0<a.dolg?"+":"")+a.dolg),$(".acc-sum").html(0!=a.acc?"Общая сумма начислений: <b>"+a.acc+"</b> руб.":"Начислений нет."),$(".zrashod").html(a.expense))},"json")},remindSpisok=function(a){var b=$("#remind").hasClass("y"),c=$("#remind .right ._calendarFilter");a={op:"remind_spisok",day:c.find(".selected").val(),status:$("#status").val(),"private":$("#private").val()};b&&$("#remind").removeClass("y");
$.post(AJAX_MAIN,a,function(a){a.success&&($(".remind_spisok").html(a.html),b&&c.html(a.cal))},"json")},incomeSpisok=function(){var a={op:"income_spisok",day:$(".selected").val(),income_id:$("#income_id").val(),worker_id:window.WORKERS?$("#worker_id").val():0,deleted:$("#deleted").val()};$(".inc-path").addClass("_busy");$.post(AJAX_MAIN,a,function(a){$(".inc-path").removeClass("_busy");a.success&&($(".inc-path").html(a.path),$("#spisok").html(a.html))},"json")},incomeChoiceSum=function(){var a,b=
$("._money .choice"),c=0,d=0,e=!0,g=[];for(a=0;a<b.length;a++){var f=b.eq(a);1==f.find("input").val()?(c++,d+=1*f.parent().find(".sum").html().replace(" ",""),g.push(f.parent().attr("val"))):e=!1}$(".income_choice_sum").html(c?"Выбран"+_end(c,["","о"])+" <b>"+c+"</b> платеж"+_end(c,["","а","ей"])+" на сумму <b>"+d+"</b> руб.":"");$("#money_all")._check(e);return{count:c,ids:g.join(),sum:d}},expenseFilter=function(){for(var a=[],b=$("#monthList input"),c=1;12>=c;c++)1==b.eq(c-1).val()&&a.push(c);return{op:"expense_spisok",
category:$("#category").val(),worker:$("#worker").val(),invoice_id:$("#invoice_id").val(),year:$("#year").val(),month:a.join()}},expenseSpisok=function(){$("#mainLinks").addClass("busy");$.post(AJAX_MAIN,expenseFilter(),function(a){$("#mainLinks").removeClass("busy");a.success&&($("#spisok").html(a.html),$("#monthList").html(a.mon))},"json")},salaryCheck=function(){var a=$("._check"),b,c,d="&nbsp;",e=0,g=0,f=[];for(b=0;b<a.length;b++)c=a.eq(b),"salary_all_check"!=c.attr("id")&&0!=c.find("input").val()&&
(e++,c=c.parent().parent(),f.push(c.attr("val")),g+=1*c.find(".sum").html());e&&(d="Выбран"+_end(e,["а","о"])+" <b>"+e+"</b> запис"+_end(e,["ь","и","ей"])+' на сумму <b id="salary-sum">'+g+'</b> руб.<a class="salary-list-create" val="'+f.join()+'">Создать лист выдачи з/п</a>');$("#salary-sel").html(d)},salarySpisok=function(){if(!$(".headName").hasClass("_busy")){var a={op:"salary_spisok",worker_id:WORKER_ID,year:$("#year").val(),mon:$("#salmon").val()};$(".headName").addClass("_busy");$.post(AJAX_MAIN,
a,function(b){$(".headName").removeClass("_busy");b.success&&(MON=1*a.mon,YEAR=a.year,$(".headName em").html(MONTH_DEF[MON]+" "+YEAR),$("#spisok").html(b.html),$("#monthList").html(b.month))},"json")}},salaryDaysGet=function(a,b){var c={op:"salary_days_get",worker_id:WORKER_ID,mon:a,year:b};$("#days-sel").addClass("_busy");$.post(AJAX_MAIN,c,function(a){$("#days-sel").removeClass("_busy");a.success&&(SALARY_DAYS=a.days)},"json")},dayFirst=function(a,b){var c=(new Date(a,b-1,1)).getDay();return 0==
c?7:c},dayCount=function(a,b){b--;0==b&&(b=12,a--);return 32-(new Date(a,b,32)).getDate()};
$.fn.clientSel=function(a){function b(b){b={op:"client_sel",val:b||"",client_id:a.client_id};c._select("process");$.post(AJAX_MAIN,b,function(b){c._select("cancel");b.success&&(c._select(b.spisok),a.client_id&&(c._select(a.client_id),a.client_id=0))},"json")}var c=$(this);a=$.extend({width:270,add:null,client_id:c.val()||0,func:function(){},funcAdd:function(){}},a);a.add&&(a.add=function(){clientAdd(function(b){var e=[];e.push(b);c._select(e);c._select(b.uid);a.funcAdd(b)})});c._select({width:a.width,
title0:"Начните вводить данные клиента...",spisok:[],write:1,nofind:"Клиентов не найдено",func:a.func,funcAdd:a.add,funcKeyup:b});b();return c};
$.fn.productList=function(a){function b(a){var b=e+g,d=b+"id",f=b+"subid",h=b+"count";m.before('<table id="ptab'+g+'" class="ptab" val="'+g+'"><tr><td class="td"><input type="hidden" id="'+d+'" value="'+(a[0]||0)+'" /><input type="hidden" id="'+f+'" value="'+(a[1]||0)+'" /><td class="td"><input type="text" id="'+h+'" value="'+(a[2]||"")+'" class="count" maxlength="3" /> шт.'+(1<g?'<div class="img_del"></div>':"")+"</table>");var k=$("#ptab"+g);k.find(".img_del").click(function(){k.remove()});$("#"+
d)._select({width:119,title0:"Не указано",spisok:PRODUCT_SPISOK,func:function(a){$("#"+f)._select("remove").val(0);0<a&&PRODUCT_SUB_SPISOK[a]&&c(a,f,h);$("#"+h).val(0<a?1:"").focus()}});c(a[0]||0,f,h);g++}function c(a,b,c){0!=a&&PRODUCT_SUB_SPISOK[a]&&$("#"+b)._select({width:120,title0:"Подвид не указан",spisok:PRODUCT_SUB_SPISOK[a],func:function(){$("#"+c).focus()}})}var d=$(this),e=d.attr("id"),g=1,f;if("string"==typeof a&&"get"==a){a=d.find(".ptab");d=[];for(f=0;f<a.length;f++){var h=a.eq(f),k=
e+h.attr("val"),h=$("#"+k+"id").val(),l=$("#"+k+"subid").val(),k=$("#"+k+"count").val();if(0!=h){if(!REGEXP_NUMERIC.test(k)||0==k)return"count_error";d.push(h+":"+l+":"+k)}}return 0==d.length?!1:d.join()}d.html('<div class="_product-list"><a class="add">Добавить поле</a></div>');var m=d.find(".add");m.click(b);if("object"==typeof a)for(f=0;f<a.length;f++)b(a[f]);else b([]);return d};
$.fn.zayavExpense=function(a){function b(a){a||(a=[0,"","",0]);var c=d+e,g=c+"cat",f=c+"worker";p.append('<table id="ptab'+e+'" class="ptab" val="'+e+'"><tr><td><input type="hidden" id="'+g+'" value="'+a[0]+'" /><td class="tddop">'+(a[0]&&ZAYAVEXPENSE_TXT[a[0]]?'<input type="text" class="zrtxt" placeholder="описание не указано" tabindex="'+(10*e-1)+'" value="'+a[1]+'" />':"")+(a[0]&&ZAYAVEXPENSE_WORKER[a[0]]?'<input type="hidden" id="'+f+'" value="'+a[1]+'" />':"")+'<td class="tdsum'+(a[0]?"":" dn")+
'"><input type="text" class="zrsum" maxlength="6"'+(a[3]?" disabled":"")+' tabindex="'+10*e+'" value="'+a[2]+'" />руб.<input type="hidden" id="'+(c+"list")+'" value="'+a[3]+'" /></table>');var h=$("#ptab"+e),k=h.find(".tddop"),m=h.find(".zrsum");$("#"+g)._select({width:120,disabled:a[3],title0:"Категория",spisok:ZAYAVEXPENSE_SPISOK,func:function(a){h.find(".tdsum")[(0<a?"remove":"add")+"Class"]("dn");ZAYAVEXPENSE_TXT[a]?(k.html('<input type="text" class="zrtxt" placeholder="описание не указано" tabindex="'+
(10*e-11)+'" />'),k.find(".zrtxt").focus()):(ZAYAVEXPENSE_WORKER[a]?(k.html('<input type="hidden" id="'+f+'" />'),$("#"+f)._select({width:150,title0:"Сотрудник",spisok:WORKER_SPISOK,func:function(a){m.focus()}})):k.html(""),m.focus());m.val("");0<a&&!h.next().hasClass("ptab")&&b()}});a[0]&&ZAYAVEXPENSE_WORKER[a[0]]&&$("#"+f)._select({width:150,disabled:a[3],title0:"Сотрудник",spisok:WORKER_SPISOK,func:function(a){m.focus()}});e++}var c=$(this),d=c.attr("id"),e=1,g;if("string"==typeof a&&"get"==a){a=
c.find(".ptab");c=[];for(g=0;g<a.length;g++){var f=a.eq(g),h=d+f.attr("val"),k=$("#"+h+"cat").val(),l=f.find(".zrsum").val(),m="";if(0!=k){if(!REGEXP_NUMERIC.test(l)||0==l)return"sum_error";ZAYAVEXPENSE_TXT[k]?m=f.find(".zrtxt").val():ZAYAVEXPENSE_WORKER[k]&&(m=$("#"+h+"worker").val());c.push(k+":"+m+":"+l+":"+$("#"+h+"list").val())}}return c.join()}c.html('<div class="_zayav-rashod"></div>');var p=c.find("._zayav-rashod");if("object"==typeof a)for(g=0;g<a.length;g++)b(a[g]);b();return c};
$(document).ajaxSuccess(function(a,b,c){function d(){var a={op:"pin_enter",pin:$.trim($("#tpin").val())};a.pin?3>a.pin.length?(e("Длина пин-кода от 3 до 10 символов"),$("#tpin").focus()):(g.process(),$.post(AJAX_MAIN,a,function(a){a.success?g.close():a.max?location.reload():(g.abort(),e(a.text),$("#tpin").val("").focus())},"json")):(e("Не заполнено поле"),$("#tpin").focus())}function e(a){g.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:-47,left:62,indent:50,show:1,remove:1})}if(b.responseJSON.pin){var g=
_dialog({width:250,head:"Подтверждение пин-кода",content:'<table class="setup-tab"><tr><td colspan="2"><div class="_info">Истекло время действия пин-кода. Требуется подтверждение.</div><tr><td class="label">Пин-код:<td><input id="tpin" type="password" maxlength="10" /></table>',butSubmit:"Подтвердить",butCancel:"",submit:d});$("#tpin").focus().keyEnter(d)}}).on("change","._attach input",function(){_cookie("_attached",0);for(var a=$(this);!a.hasClass("_attach");)a=a.parent();var b=a.find("form"),c=
a.find(".form"),d=setInterval(function(){var e=_cookie("_attached");0<e&&(clearInterval(d),1==e?(e={op:"attach_get",type:b.find(".type").val(),zayav_id:b.find(".zayav_id").val()},$.post(AJAX_MAIN,e,function(e){c.removeClass("_busy");e.success&&(a.find(".files").html(e.files),b.html(e.form))},"json")):(c.removeClass("_busy"),c.next(".red").remove(),c.after('<div class="red">Некорректный файл.</div>'),c.next(".red").fadeOut(4E3)))},500);c.addClass("_busy");b.submit()}).on("click","._attach .img_minidel",
function(){var a=$(this),b={op:"attach_del",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success&&(a.prev().remove(),a.remove())},"json")}).on("click",".accrual-del",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();if(!a.hasClass("deleting")){a.addClass("deleting");var b={op:"accrual_del",id:a.attr("val")};$.post(AJAX_MAIN,b,function(c){a.removeClass("deleting");c.success&&(zayavInfoMoneyUpdate(),a.after('<tr class="deleted" val="'+b.id+'"><td colspan="4"><div>Начисление удалено. <a class="accrual-rest">Восстановить</a></div>'),
a.addClass("dn"))},"json")}}).on("click",".accrual-rest",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b={op:"accrual_rest",id:a.attr("val")},c=a.find("div");c.hasClass("_busy")||(c.addClass("_busy"),$.post(AJAX_MAIN,b,function(b){c.removeClass("busy");b.success&&(zayavInfoMoneyUpdate(),a.prev().removeClass("dn"),a.remove())},"json"))}).on("click","#client ._next",function(){var a=$(this),b=clientFilter();a.hasClass("busy")||(b.page=a.attr("val"),a.addClass("busy"),$.post(AJAX_MAIN,
b,function(b){b.success?a.after(b.spisok).remove():a.removeClass("busy")},"json"))}).on("click","#client #filter_clear",function(){$("#find")._search("clear");$("#dolg")._check(0);$("#worker")._check(0);$("#note")._check(0);$("#zayav_cat")._select(0);$("#product_id")._select(0);clientSpisok()}).on("click",".zayav_add",function(){_dialog({width:370,top:30,head:"Выберите категорию заявки",content:'<div class="zayav-add"><div class="item zakaz_add"><b>Заказ</b>Новый заказ для продажи изделий без установки.<br />При необходимости в будущем заказ можно будет перевести в Установку.</div><div class="item zamer_add"><b>Замер</b>Новая заявка на замер. Указывается дата и время замера. Заявка автоматически попадает в напоминания. Успешный замер переносится на заключение договора.</div><div class="item set_add"><b>Установка</b>Новая заявка на установку изделий.</div>',
butSubmit:""})}).on("click",".zayav_unit",function(){document.location.href=URL+"&p=zayav&d=info&id="+$(this).attr("val")}).on("click","#zayav ._next",function(){var a=$(this);if(!a.hasClass("busy")){var b=zayavFilter();b.page=a.attr("val");a.addClass("busy");$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.spisok).remove():a.removeClass("busy")},"json")}}).on("click","#zayav .filter_clear",function(){$(".find-hide").removeClass("dn");$("#find")._search("clear");$("#status").length&&$("#status").rightLink(0);
$("#product_id")._select(0);$("#zp_expense").length&&($("#zp_expense")._radio(0),$("#zpe_worker_select").addClass("dn"),$("#zpe_worker")._select(0),$("#account")._check(0));zayavSpisok()}).on("click",".zakaz_add",function(){window.CLIENT||(CLIENT={id:0,fio:"",adres:""});var a=_dialog({width:550,top:30,head:"Внесение нового заказа",content:'<table class="zayav-add"><tr><td class="label">Клиент:<td><INPUT type="hidden" id="client_id" value="'+CLIENT.id+'"><b>'+CLIENT.fio+'</b><tr><td class="label topi">Изделие:<td id="product"><tr><td><td><input type="text" id="zakaz_txt" placeholder="либо укажите содержание заказа вручную.." maxlength="300"><tr><td class="label top">Заметка:\t<td><textarea id="comm"></textarea></table>',
submit:function(){var b,c={op:"zakaz_add",client_id:$("#client_id").val(),product:$("#product").productList("get"),zakaz_txt:$("#zakaz_txt").val(),comm:$("#comm").val()};0==c.client_id?b="Не выбран клиент":c.product||c.zakaz_txt?"count_error"==c.product?b="Некорректно введено количество изделий":(a.process(),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("Заявка внесена"),location.href=URL+"&p=zayav&d=info&id="+b.id):a.abort()},"json")):b="Необходимо выбрать изделие или вписать заказ вручную";
b&&a.bottom.vkHint({msg:'<SPAN class="red">'+b+"</SPAN>",top:-48,left:171,indent:50,show:1,remove:1})}});CLIENT.id||$("#client_id").clientSel({add:1});$("#product").productList();$("#comm").autosize()}).on("click",".zakaz_status",function(){$(this);var a=_dialog({top:30,width:300,head:"Изменение статуса заказа",content:'<div class="zayav-status">'+(1!=ZAYAV.status?'<div class="st c1" val="1">Заказ ожидает выполнения<div class="about">Возобновление работы по заказу.</div></div>':"")+'<div class="st c2" val="2">Заказ выполнен<div class="about">Все начисления произведены, изделия переданы клиенту.</div><div class="label">Уточните день выполнения заказа:</div><input type="hidden" id="day" value="'+
(ZAYAV.status_day||"")+'"></div>'+(3!=ZAYAV.status?'<div class="st c3" val="3">Заказ отменён<div class="about">Отмена заказа по какой-либо причине.</div></div>':"")+"</div>",butSubmit:"",butCancel:"Закрыть"});$("#day")._calendar({lost:1});$(".st").click(function(){var b=$(this),c={op:"zakaz_status",zayav_id:ZAYAV.id,status:b.attr("val"),day:$("#day").val()||""},d=b.parent();d.hasClass("busy")||(d.addClass("busy"),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("Данные изменены!"),document.location.reload()):
d.removeClass("busy")},"json"))})}).on("click",".zamer_table",function(){var a=_dialog({width:600,top:10,head:"Таблица замеров",load:1,butSubmit:"",butCancel:"Закрыть"}),b={op:"zamer_table_get",val:$(this).attr("val")||0};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},"json")}).on("click","#zamer-table .ztu",function(){document.location.href=URL+"&p=zayav&d=info&id="+$(this).attr("val")}).on("click","#zamer-table .mon a",function(){var a=$(this),b=a.parent(),a={op:"zamer_table_get",
mon:a.attr("val")};b.hasClass("_busy")||(b.addClass("_busy"),$.post(AJAX_MAIN,a,function(a){a.success?$("#zamer-table").parent().html(a.html):b.removeClass("_busy")},"json"))}).on("click",".zamer_add",function(){function a(a){c.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:185,indent:40,show:1,remove:1})}window.CLIENT||(CLIENT={id:0,fio:"",adres:""});var b=CLIENT.adres,c=_dialog({width:550,top:30,head:"Внесение новой заявки на замер",content:'<table class="zayav-add"><tr><td class="label">Клиент:<td><INPUT type="hidden" id="client_id" value="'+
CLIENT.id+'"><b>'+CLIENT.fio+'</b><tr><td class="label topi">Изделие:<td id="product"><tr><td class="label">Адрес проведения замера:<td><INPUT type="text" id="adres" maxlength="100" /><INPUT type="hidden" id="homeadres" /><tr><td class="label">Дата и время замера:<td class="zayav-zamer-dtime"><tr><td class="label">Длительность замера:<td><INPUT TYPE="hidden" id="zamer_duration" value="30" /><tr><td class="label top">Заметка:\t<td><textarea id="comm"></textarea></table>',submit:function(){var b={op:"zamer_add",
client_id:$("#client_id").val(),product:$("#product").productList("get"),adres:$("#adres").val(),zamer_day:$("#zamer_day").val(),zamer_hour:$("#zamer_hour").val(),zamer_min:$("#zamer_min").val(),zamer_duration:$("#zamer_duration").val(),comm:$("#comm").val()};0==b.client_id?a("Не выбран клиент"):b.product?"count_error"==b.product?a("Некорректно введено количество изделий"):b.adres?(c.process(),$.post(AJAX_MAIN,b,function(b){b.success?(c.close(),_msg("Заявка внесена"),location.href=URL+"&p=zayav&d=info&id="+
b.id):(c.abort(),a(b.text))},"json")):a("Не указан адрес"):a("Не указано изделие")}});CLIENT.id||$("#client_id").clientSel({add:1,func:function(a,c,g){b=a?g.adres:"";1==$("#homeadres").val()&&$("#adres").val(b)}});$("#product").productList();$("#homeadres")._check({func:function(){$("#adres").val(b)}});$("#homeadres_check").vkHint({msg:"Совпадает с адресом проживания",top:-75,left:193,indent:60,delayShow:700});zayavZamerDtime({});$("#comm").autosize()}).on("click",".zamer_status",function(){function a(a){e.content.html('<div class="zayav-status"><div class="st c1" val="1">Указать новое время<div class="about">Замер будет перенесён на другое время.</div></div><div class="st c2" val="2">Замер выполнен<div class="about">Замер выполнен успешно. Заявка будет переведена на заключение договора.</div></div>'+
(3!=a.status?'<div class="st c3" val="3">Отмена<div class="about">Отмена заявки по какой-либо причине.</div></div>':"")+'<table class="zstab"><tr><td class="label">Новое время:<td class="zayav-zamer-dtime"><tr><td class="label">Длительность:<td><INPUT TYPE="hidden" id="zamer_duration" value="'+a.dur+'" /><a class="zamer_table" val="'+d+'">Таблица замеров</a><tr><td><td><div class="vkButton"><button>Сохранить</button></div></table></div>');zayavZamerDtime(a);$(".st").click(function(){var a=$(this).attr("val");
1==a?($(".st").hide(),$(".zstab").show()):b(a)});$(".zayav-status .vkButton").click(function(){$(this).addClass("busy");b(1)})}function b(a){a={op:"zamer_status",zayav_id:d,status:a,zamer_day:$("#zamer_day").val(),zamer_hour:$("#zamer_hour").val(),zamer_min:$("#zamer_min").val(),zamer_duration:$("#zamer_duration").val()};$.post(AJAX_MAIN,a,function(a){a.success?(e.close(),_msg("Данные изменены!"),document.location.reload()):$(".zayav-status .vkButton").removeClass("busy").vkHint({msg:'<SPAN class="red">'+
a.text+"</SPAN>",top:-58,left:-5,indent:40,remove:1,show:1})},"json")}var c=$(this),d="undefined"!=typeof ZAYAV?ZAYAV.id:c.attr("val"),e=_dialog({width:400,top:30,head:"Изменение статуса замера",load:1,butSubmit:"",butCancel:"Закрыть"});"undefined"==typeof ZAYAV?$.post(AJAX_MAIN,{op:"zamer_info_get",zayav_id:d},function(b){b.success?a(b):e.loadError()},"json"):a(ZAYAV)}).on("click",".set_add",function(){window.CLIENT||(CLIENT={id:0,fio:"",adres:""});var a=CLIENT.adres,b=_dialog({width:550,top:30,
head:"Внесение новой заявки на установку",content:'<table class="zayav-add"><tr><td class="label">Клиент:<td><INPUT type="hidden" id="client_id" value="'+CLIENT.id+'"><b>'+CLIENT.fio+'</b><tr><td class="label topi">Изделие:<td id="product"><tr><td class="label">Адрес установки:<td><INPUT type="text" id="adres" maxlength="100" /><INPUT type="hidden" id="homeadres" /><tr><td class="label top">Заметка:\t<td><textarea id="comm"></textarea></table>',submit:function(){var a,d={op:"set_add",client_id:$("#client_id").val(),
product:$("#product").productList("get"),adres:$("#adres").val(),comm:$("#comm").val()};0==d.client_id?a="Не выбран клиент":d.product?"count_error"==d.product?a="Некорректно введено количество изделий":d.adres?(b.process(),$.post(AJAX_MAIN,d,function(a){a.success?(b.close(),_msg("Заявка внесена"),location.href=URL+"&p=zayav&d=info&id="+a.id):b.abort()},"json")):a="Не указан адрес":a="Не указано изделие";a&&b.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:171,indent:50,show:1,remove:1})}});
CLIENT.id||$("#client_id").clientSel({add:1,func:function(b,d,e){a=b?e.adres:"";1==$("#homeadres").val()&&$("#adres").val(a)},funcAdd:function(b){a=b.adres;1==$("#homeadres").val()&&$("#adres").val(a)}});$("#product").productList();$("#homeadres")._check({func:function(){$("#adres").val(a)}});$("#homeadres_check").vkHint({msg:"Совпадает с адресом проживания",top:-75,left:193,indent:60,delayShow:700});$("#comm").autosize()}).on("click",".set_status",function(){$(this);var a=_dialog({top:30,width:360,
head:"Изменение статуса установки",content:'<div class="zayav-status">'+(1!=ZAYAV.status?'<div class="st c1" val="1">Ожидает установку<div class="about">Возобновление работы по заявке.</div></div>':"")+'<div class="st c2" val="2">Установка выполнена<div class="about">Произведена установка всех изделий. Не забудьте расписать расходы по заявке и проверьте начисления.</div><div class="label">Уточните день выполнения установки:</div><input type="hidden" id="day" value="'+(ZAYAV.status_day||"")+'"></div>'+
(3!=ZAYAV.status?'<div class="st c3" val="3">Заявка отменена<div class="about">Отмена заявки по какой-либо причине.</div></div>':"")+"</div>",butSubmit:"",butCancel:"Закрыть"});$("#day")._calendar({lost:1});$(".st").click(function(){var b=$(this),c={op:"set_status",zayav_id:ZAYAV.id,status:b.attr("val"),day:$("#day").val()||""},d=b.parent();d.hasClass("busy")||(d.addClass("busy"),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("Данные изменены!"),document.location.reload()):d.removeClass("busy")},
"json"))})}).on("click",".refund-del",function(){for(var a=$(this),b=_dialog({top:110,width:250,head:"Удаление",content:"<CENTER>Подтвердите удаление возврата.</CENTER>",butSubmit:"Удалить",submit:function(){var c={op:"refund_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?(b.close(),zayavInfoMoneyUpdate(),_msg("Удалено."),$("#income_spisok").html(a.html)):b.abort()},"json")}});"TR"!=a[0].tagName;)a=a.parent()}).on("click",".remind-add",function(){var a=_dialog({top:40,
width:420,head:"Внесение нового напоминания",content:'<table class="remind-add-tab">'+(window.ZAYAV?'<tr><td class="label">Заявка:<td><b>'+ZAYAV.head+"</b>":"")+(window.CLIENT?'<tr><td class="label">Клиент:<td>'+CLIENT.fio:"")+'<tr><td class="label top">Описание:<td><textarea id="txt"></textarea><tr><td class="label">День выполнения:<TD><INPUT type="hidden" id="day" /><tr><td class="label">Личное:<TD><INPUT type="hidden" id="add-private" /></table><input type="hidden" id="client_id" value="'+(window.CLIENT?
CLIENT.id:0)+'"><input type="hidden" id="zayav_id" value="'+(window.ZAYAV?ZAYAV.id:0)+'">',submit:function(){var b={op:"remind_add",from:window.ZAYAV?"zayav":window.CLIENT?"client":"",client_id:$("#client_id").val(),zayav_id:$("#zayav_id").val(),txt:$.trim($("#txt").val()),day:$("#day").val(),"private":$("#add-private").val()};b.txt?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?(a.close(),_msg("Напоминание внесено"),$(".remind_spisok").html(b.html)):a.abort()},"json")):(a.bottom.vkHint({msg:'<SPAN class="red">Не указано описание</SPAN>',
top:-48,left:126,indent:40,show:1,remove:1}),$("#txt").focus())}});$("#txt").autosize().focus();$("#day")._calendar();$("#add-private")._check();$("#private_check").vkHint({msg:"Напоминание сможете<br />видеть только Вы.",top:-71,left:-11,indent:"left",delayShow:1E3})}).on("click",".remind_status",function(){function a(a){a={op:"remind_status",from:window.ZAYAV?"zayav":window.CLIENT?"client":"",id:b.attr("val"),status:a,day:$("#remind_day").val(),reason:$("#reason").val()};$.post(AJAX_MAIN,a,function(a){a.success&&
(c.close(),_msg("Данные изменены!"),$(".remind_spisok").html(a.html))},"json")}var b=$(this),c=_dialog({top:30,head:"Изменение статуса напоминания",content:'<div class="zayav-status remind-status"><div class="st c1" val="1">Указать другой день<div class="about">Перенести напоминание на другой день.</div></div><div class="st c2" val="2">Выполнено<div class="about">Задание выполнено успешно.</div></div><div class="st c0" val="0">Отмена<div class="about">Отмена напоминания по какой-либо причине.</div></div><table class="zstab"><tr><td class="label">Новый день:<td><input type="hidden" id="remind_day" /><tr><td class="label">Причина:<td><input type="text" id="reason" /><tr><td><td><div class="vkButton"><button>Применить</button></div></table></div>',
butSubmit:"",butCancel:"Закрыть"});$("#remind_day")._calendar();$(".st").click(function(){var b=$(this).attr("val");1==b?($(".c2,.c0").hide(),$(".zstab").show()):a(b)});$(".remind-status .vkButton").click(function(){$(this).addClass("busy");a(1)})}).on("click",".remind_history",function(){var a={op:"remind_history",id:$(this).attr("val")},b=$("#ru"+a.id+" .hist");b.hasClass("_busy")||(b.html()?b.slideToggle(300):(b.html("&nbsp;").addClass("_busy"),$.post(AJAX_MAIN,a,function(a){b.removeClass("_busy");
a.success&&b.html(a.html)},"json")))}).on("click",".invoice_set",function(){function a(){var a=[];if(g)for(n=0;n<e;n++){var d=h.eq(n).val();if(REGEXP_CENA.test(d))a.push(CASH[n].id+"="+1*d.replace(",","."));else{b("Некорректно указана сумма");h.eq(n).focus();return}}a={op:"invoice_set",invoice_id:c,sum:g?0:$("#sum").val(),cash:a.join(":")};g||REGEXP_CENA.test(a.sum)?(f.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#cash-spisok").html(a.c),$("#invoice-spisok").html(a.i),f.close(),_msg("Баланс установлен.")):
f.abort()},"json")):(b("Некорректно указана сумма"),$("#sum").focus())}function b(a){f.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-48,left:72})}window.CASH||(window.CASH=[]);var c=$(this).attr("val"),d='<table class="_dialog-tab">',e=CASH.length,g="1"==c&&!!e;if(g){for(n=0;n<e;n++)d+='<tr><td class="label">'+CASH[n].name+':<td><INPUT type="text" class="money" maxlength="11" value="'+CASH[n].sum+'"> руб.';d+='<tr><td class="label">Счёт <b>'+INVOICE_NAME+'</b>:<td><b id="summa">0</b> руб.'}else d+=
'<tr><td class="label">Сумма:<td><INPUT type="text" class="money" id="sum" maxlength="11"> руб.';var f=_dialog({width:320,head:"Установка текущей суммы счёта",content:d+"</table>",butSubmit:"Установить",submit:a}),h=f.content.find("input");h.eq(0).focus();h.keyEnter(a);g&&h.keyup(function(){var a=0;for(n=0;n<e;n++){var b=h.eq(n).val();if(REGEXP_CENA.test(b))a+=1*b.replace(",",".");else{a=0;break}}$("#summa").html(a)})}).on("click","#report.invoice .img_note",function(){var a=_dialog({top:20,width:570,
head:"История операций со счётом",load:1,butSubmit:"",butCancel:"Закрыть"}),b={op:"invoice_history",invoice_id:$(this).attr("val")};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},"json")}).on("click",".invoice-history ._next",function(){var a=$(this),b={op:"invoice_history",page:a.attr("val"),invoice_id:$("#invoice_history_id").val()};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",
"#money_all_check",function(){for(var a=$(this),b=a.find("input").val();!a.hasClass("_money");)a=a.parent();for(var c=a.find("tr"),a=1;a<c.length;a++)c.eq(a).find("input:first")._check(b)}).on("click",".inc ._check",incomeChoiceSum).on("click",".transfer-show",function(){var a=_dialog({top:20,width:480,head:"Просмотр подтверждённых переводов",load:1,butSubmit:"",butCancel:"Закрыть"}),b={op:"transfer_show",ids:$(this).attr("val")};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},
"json")}).on("click",".transfer-spisok .img_del",function(){var a=$(this),b=_dialog({head:"Удаление перевода",content:"<center>Подтвердите удаление перевода.</center>",butSubmit:"Удалить",submit:function(){var c={op:"transfer_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?($("#cash-spisok").html(a.c),$("#invoice-spisok").html(a.i),$(".transfer-spisok").html(a.t),b.close(),_msg("Перевод удалён.")):b.abort()},"json")}})}).on("click",".transfer-spisok ._next",function(){var a=
$(this),b={op:"transfer_spisok",page:a.attr("val")};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".income-confirm",function(){var a=_dialog({top:20,width:480,head:"Подтверждение платежей",load:1,butSubmit:"Подтвердить",submit:function(){var b={op:"income_confirm",ids:incomeChoiceSum().ids};b.ids?(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($("#confirm-info").html(b.confirm),$("#cash-spisok").html(b.c),
$("#invoice-spisok").html(b.i),a.close(),_msg("Платежи подтверждены.")):a.abort()},"json")):a.bottom.vkHint({msg:'<SPAN class="red">Платежи не выбраны</SPAN>',remove:1,indent:50,show:1,top:-48,left:143})}});$.post(AJAX_MAIN,{op:"income_confirm_get"},function(b){b.success?a.content.html(b.html+'<div class="income_choice_sum"></div>'):a.loadError()},"json")}).on("click",".transfer-confirm",function(){function a(){for(var a=b.content.find("._check"),d=[],e=0;e<a.length;e++){var g=a.eq(e).find("input");
1==g.val()&&d.push(g.attr("id").split("_")[0])}d.length?(a={op:"transfer_confirm",ids:d.join(),about:$("#about").val()},b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#invoice-spisok").html(a.i),$(".transfer-spisok").html(a.t),b.close(),_msg("Переводы подтверждены.")):b.abort()},"json")):b.bottom.vkHint({msg:'<SPAN class="red">Платежи не выбраны</SPAN>',remove:1,indent:50,show:1,top:-48,left:163})}var b=_dialog({top:20,width:520,head:"Подтверждение переводов",load:1,butSubmit:"Подтвердить",
submit:a});$.post(AJAX_MAIN,{op:"transfer_confirm_get"},function(c){c.success?(b.content.html(c.html+'<div class="transfer-about">Описание: <input type="text" id="about" /></div>'),$("#about").keyEnter(a)):b.loadError()},"json")}).on("click",".income-show",function(){var a=_dialog({top:20,width:480,head:"Просмотр платежей",load:1,butSubmit:"",butCancel:"Закрыть"}),b={op:"income_transfer_show",ids:$(this).attr("val")};$.post(AJAX_MAIN,b,function(b){b.success?a.content.html(b.html):a.loadError()},"json")}).on("click",
".income-add",function(){function a(){var a={op:"income_add",from:OPL.from,type:$("#income_opl").val(),confirm:$("#confirm").val(),sum:$("#sum").val(),zayav_id:$("#zayav_id").val()||0,client_id:OPL.client_id||0,prim:$.trim($("#prim").val())};0==a.type?b("Не указан вид платежа"):REGEXP_CENA.test(a.sum)&&0!=a.sum?$("#zayav_id").length&&0==a.zayav_id&&!a.prim?(b("Если не выбрана заявка, необходимо указать комментарий"),$("#prim").focus()):$("#zayav_id").length||a.prim?(d.process(),$.post(AJAX_MAIN,a,
function(a){if(a.success)switch(d.close(),_msg("Платёж успешно внесён!"),OPL.from){case "client":$("#income_spisok").html(a.html);$(".left:first").html(a.balans);break;case "zayav":zayavInfoMoneyUpdate();$("#income_spisok").html(a.html);break;case "income":incomeSpisok()}else d.abort()},"json")):(b("Необходимо указать комментарий"),$("#prim").focus()):(b("Некорректно указана сумма."),$("#sum").focus())}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-48,
left:135})}var c='<table class="income-add-tab">'+("income"!=OPL.from?'<tr><td class="label">Клиент:<td>'+OPL.client_fio+'<tr><td class="label">Заявка:<td><input type="hidden" id="zayav_id" value="'+(OPL.zayav_id?OPL.zayav_id:0)+'">'+(OPL.zayav_id?"<b>"+OPL.zayav_head+"</b>":""):"")+'<tr><td class="label">Вид платежа:<td><input type="hidden" id="income_opl"><a href="'+URL+'&p=setup&d=income" class="img_edit'+_tooltip("Настройка видов платежей",-85)+'</a><tr class="tr_confirm dn"><td class="label">Подтверждение:<td><input type="hidden" id="confirm"><tr><td class="label">Сумма:<td><input type="text" id="sum" class="money" maxlength="11"> руб.<tr><td class="label">Комментарий:<td><input type="text" id="prim" maxlength="100"></table>',
d=_dialog({width:440,head:"Внесение платежа",content:c,submit:a});$("#sum").focus();$("#sum,#prim").keyEnter(a);OPL.zayav_spisok&&$("#zayav_id")._select({width:210,title0:"Не указана",spisok:OPL.zayav_spisok});$("#income_opl")._select({width:180,title0:"Не указан",spisok:INCOME_SPISOK,func:function(a){$("#sum").focus();$(".tr_confirm")[(INCOME_CONFIRM[a]?"remove":"add")+"Class"]("dn");$("#confirm")._check(0)}});$("#confirm")._check();$("#confirm_check").vkHint({width:210,msg:"Установите галочку, если платёж нужно внести, но требуется подтверждение о его поступлении на счёт.",
top:-96,left:-100})}).on("click",".income-del",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();if(!a.hasClass("deleting")){a.addClass("deleting");var b={op:"income_del",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){a.removeClass("deleting");b.success&&(window.ZAYAV&&zayavInfoMoneyUpdate(),a.addClass("deleted"))},"json")}}).on("click",".income-rest",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b={op:"income_rest",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success&&
(window.ZAYAV&&zayavInfoMoneyUpdate(),a.removeClass("deleted"))},"json")}).on("click","#income_next",function(){var a=$(this),b={op:"income_next",page:$(this).attr("val"),limit:$("#money_limit").val(),client_id:$("#money_client_id").val(),zayav_id:$("#money_zayav_id").val(),deleted:$("#money_deleted").val(),income_id:$("#money_income_id").val(),owner_id:$("#money_owner_id").val(),worker_id:$("#money_worker_id").val(),day:$(".selected").val()||""};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,
b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".expense #monthList div",expenseSpisok).on("click",".expense ._next",function(){var a=$(this),b=expenseFilter();b.page=a.attr("val");a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".expense .img_del",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();if(!a.hasClass("deleting")){a.addClass("deleting");
var b={op:"expense_del",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){a.removeClass("deleting");b.success&&a.addClass("deleted")},"json")}}).on("click",".expense .img_rest",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b={op:"expense_rest",id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success&&a.removeClass("deleted")},"json")}).on("click",".expense .img_edit",function(){function a(a){c.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,
left:101})}for(var b=$(this);"TR"!=b[0].tagName;)b=b.parent();var c=_dialog({width:380,head:"Редактирование расхода",load:1,butSubmit:"Сохранить",submit:function(){var b={id:d,op:"expense_edit",category:1*$("#cat").val(),about:$("#about").val(),worker:$("#work").val(),invoice:1*$("#invoice").val(),sum:$("#sum").val()};b.category||b.about?b.invoice?REGEXP_NUMERIC.test(b.sum)?(c.process(),$.post(AJAX_MAIN,b,function(a){a.success?(c.close(),_msg("Расход изменён."),expenseSpisok()):c.abort()},"json")):
(a("Некорректно указана сумма."),$("#sum").focus()):a("Укажите с какого счёта производится оплата."):(a("Выберите категорию или укажите описание."),$("#about").focus())}}),d=b.attr("val");$.post(AJAX_MAIN,{op:"expense_get",id:d},function(a){c.content.html('<table id="expense-add-tab"><tr><td class="label">Категория:<td><input type="hidden" id="cat" value="'+a.category+'"><tr class="tr-work '+(EXPENSE_WORKER[a.category]?"":"dn")+'"><td class="label">Сотрудник:<td><input type="hidden" id="work" value="'+
a.worker+'"><tr><td class="label">Описание:<td><input type="text" id="about" maxlength="150" value="'+a.about+'"><tr><td class="label">Со счёта:<td><input type="hidden" id="invoice" value="'+a.invoice+'"><tr><td class="label">Сумма:<td><input type="text" id="sum" class="money" maxlength="8" value="'+a.sum+'"> руб.</table>');$("#cat")._select({width:180,title0:"Не указана",spisok:EXPENSE_SPISOK,func:function(a){$("#work")._select(0);$(".tr-work")[(EXPENSE_WORKER[a]?"remove":"add")+"Class"]("dn")}});
$("#about").focus();$("#work")._select({title0:"Не выбран",spisok:WORKER_SPISOK});$("#invoice")._select({title0:"Не выбран",spisok:INVOICE_SPISOK,func:function(){$("#sum").focus()}})},"json")}).on("click","#report_month .yr",function(){$(this).next().toggle()}).on("click",".salary .rate-set",function(){function a(){var a={op:"salary_rate_set",worker:WORKER_ID,sum:$("#sum").val(),day:1*$("#day").val()};REGEXP_CENA.test(a.sum)?!REGEXP_NUMERIC.test(a.day)||!a.day||28<a.day?(b("Некорректно указан день."),
$("#day").focus()):(c.process(),$.post(AJAX_MAIN,a,function(b){b.success?(RATE=a.sum,RATE_DAY=a.day,c.close(),_msg("Установка ставки произведена."),salarySpisok()):c.abort()},"json")):(b("Некорректно указана сумма."),$("#sum").focus())}function b(a){c.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:74})}var c=_dialog({top:30,width:320,head:"Установка ставки з/п для сотрудника",content:'<div class="_info">После установки ставки сотруднику указанная сумма будет автоматически начисляться на его баланс ежемесячно в определённый день. День начисления может быть выбран в промежутке от 1-го до 28 числа.</div><table class="salary-tab"><tr><td class="label">Сумма:<TD><INPUT type="text" id="sum" class="money" maxlength="11" value="'+
(RATE?RATE:"")+'" /> руб.<tr><td class="label">День начисления:<TD><INPUT type="text" id="day" maxlength="2" value="'+(RATE?RATE_DAY:"")+'" /></table>',butSubmit:"Установить",submit:a});$("#sum").focus();$("#sum,#day").keyEnter(a)}).on("click",".salary .up",function(){function a(){var a=$("#days-sel-tab .sel"),b=a.length,c,e;g=0;f=[];h={};for(d=0;d<b;d++){c=a.eq(d).find("input");e=c.attr("val");c=c.val();if(!REGEXP_NUMERIC.test(c)){b=0;f="";break}g+=1*c;f.push(e+":"+c);h[e]=c}f=f.join();$("#days-selected").html(b?
"Выбран"+_end(b,["","о"])+" <b>"+b+"</b> д"+_end(b,["ень","ня","ней"])+", сумма: <b>"+g+"</b> руб.":"");return b}function b(){var b=a();if(!b)return k.bottom.vkHint({msg:'<SPAN class="red">Не выбраны дни или некорректно заполнены суммы</SPAN>',remove:1,indent:40,show:1,top:-47,left:162}),!1;$("#days-sel").html("Выбран"+_end(b,["","о"])+" "+b+" д"+_end(b,["ень","ня","ней"]));$("#sum").val(g);k.close();return!0}function c(){var a={op:"salary_up",worker_id:WORKER_ID,daysel:f,sum:$("#sum").val(),about:$("#about").val(),
mon:$("#tabmon").val(),year:$("#tabyear").val()};REGEXP_NUMERIC.test(a.sum)?(l.process(),$.post(AJAX_MAIN,a,function(a){a.success?(l.close(),_msg("Начисление произведено."),salarySpisok()):l.abort()},"json")):(l.bottom.vkHint({msg:'<SPAN class="red">Некорректно указана сумма.</SPAN>',remove:1,indent:40,show:1,top:-47,left:93}),$("#sum").focus())}var d,e=300,g,f="",h,k,l=_dialog({head:"Внесение начисления для сотрудника",content:'<table class="salary-tab"><tr><td class="label">Месяц:<td><input type="hidden" id="tabmon" value="'+
MON+'" /> <input type="hidden" id="tabyear" value="'+YEAR+'" /><a id="days-sel">Выбрать дни</a><tr><td class="label">Сумма:<td><input type="text" id="sum" class="money" maxlength="8" /> руб.<tr><td class="label">Описание:<td><input type="text" id="about" maxlength="50" /></table>',submit:c});salaryDaysGet(MON,YEAR);$("#sum").focus().keyup(function(){$(this).val()!=g&&($("#days-sel").html("Выбрать дни"),f="")});$("#sum,#about").keyEnter(c);$("#tabmon")._select({width:80,spisok:MON_SPISOK,func:function(a){salaryDaysGet(a,
$("#tabyear").val());$("#days-sel").html("Выбрать дни");f="";$("#sum").focus()}});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK,func:function(a){salaryDaysGet($("#tabmon").val(),a);$("#days-sel").html("Выбрать дни");f="";$("#sum").focus()}});$("#days-sel").click(function(){var c=$("#tabyear").val(),g=$("#tabmon").val(),l=dayFirst(c,g),q=dayCount(c,g),c='<div id="days-sel-tab"><div id="head-mon">'+MONTH_DEF[g]+" "+c+'</div><table id="days-cal"><tr><th>Пн<th>Вт<th>Ср<th>Чт<th>Пт<th>Сб<th>Вс<tr>';
if(1<l)for(d=0;d<l-1;d++)c+="<td>";f||(h={});for(d=1;d<=q;d++)c+='<td class="onday'+(SALARY_DAYS[d]?" all":" to")+(h[d]?" sel":"")+'">'+d+(SALARY_DAYS[d]?'<div class="dsum"><b>'+SALARY_DAYS[d]+"</b> руб.</div>":'<br /><input type="text" maxlength="5" val="'+d+'" value="'+h[d]+'" />'),l++,8==l&&d!=q&&(c+="<tr>",l=1);k=_dialog({top:40,width:495,head:"Выбор дней",butSubmit:"Готово",content:c+'</table><div id="days-selected"></div></div>',submit:b});a();$("#days-sel-tab .onday.to").click(function(b){var c=
$(this);"INPUT"!=$(b.target)[0].tagName&&(c.hasClass("sel")?c.removeClass("sel"):c.addClass("sel").find("input").focus().val(e),a())});$("#days-sel-tab input").keyup(function(){var b=$(this).val();REGEXP_NUMERIC.test(b)&&(e=b);a()})})}).on("click",".salary .down",function(){function a(){var a={op:"salary_down",worker:WORKER_ID,invoice:1*$("#invoice").val(),sum:$("#sum").val(),about:$("#about").val(),mon:$("#tabmon").val(),year:$("#tabyear").val()};a.invoice?REGEXP_NUMERIC.test(a.sum)?(d.process(),
$.post(AJAX_MAIN,a,function(a){a.success?(d.close(),_msg("Выдача зарплаты произведена."),salarySpisok()):d.abort()},"json")):(b("Некорректно указана сумма."),$("#sum").focus()):b("Укажите с какого счёта производится выдача.")}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:93})}var c='<table class="salary-tab"><tr><td class="label">Со счёта:<TD><input type="hidden" id="invoice"><a href="'+URL+'&p=setup&d=invoice" class="img_edit'+_tooltip("Настройка счетов",
-56)+'</a><tr><td class="label">Сумма:<td><input type="text" id="sum" class="money" maxlength="8"> руб.<tr><td class="label">Описание:<td><input type="text" id="about" maxlength="100"><tr><td class="label">Месяц:<td><input type="hidden" id="tabmon" value="'+MON+'" /> <input type="hidden" id="tabyear" value="'+YEAR+'" /></table>',d=_dialog({head:"Выдача зарплаты сотруднику",content:c,submit:a});$("#sum").focus();$("#invoice")._select({title0:"Не выбран",spisok:INVOICE_SPISOK,func:function(){$("#sum").focus()}});
$("#sum,#about").keyEnter(a);$("#tabmon")._select({width:80,spisok:MON_SPISOK});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK})}).on("click",".salary .deduct",function(){function a(){var a={op:"salary_deduct",worker:WORKER_ID,sum:$("#sum").val(),about:$("#about").val(),mon:$("#tabmon").val(),year:$("#tabyear").val()};REGEXP_NUMERIC.test(a.sum)?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?(b.close(),_msg("Вычет произведён."),salarySpisok()):b.abort()},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">Некорректно указана сумма.</SPAN>',
remove:1,indent:40,show:1,top:-47,left:93}),$("#sum").focus())}var b=_dialog({head:"Внесение вычета из зарплаты",content:'<table class="salary-tab"><tr><td class="label">Сумма:<TD><input type="text" id="sum" class="money" maxlength="8"> руб.<tr><td class="label">Описание:<TD><input type="text" id="about" maxlength="100"><tr><td class="label">Месяц:<td><input type="hidden" id="tabmon" value="'+MON+'" /> <input type="hidden" id="tabyear" value="'+YEAR+'" /></table>',submit:a});$("#sum").focus();$("#sum,#about").keyEnter(a);
$("#tabmon")._select({width:80,spisok:MON_SPISOK});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK})}).on("click",".salary .start-set",function(){function a(){var a={op:"salary_start_set",worker:WORKER_ID,sum:$("#sum").val()};REGEXP_CENA.test(a.sum)?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?(b.close(),_msg("Установка произведёна."),$("#spisok").html(a.html)):b.abort()},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">Некорректно указана сумма.</SPAN>',remove:1,indent:40,show:1,top:-47,
left:93}),$("#sum").focus())}var b=_dialog({head:"Установка баланса по зарплате сотрудника",content:'<table class="salary-tab"><tr><td class="label">Сумма:<TD><INPUT type="text" id="sum" class="money" maxlength="8"> руб.</table>',butSubmit:"Применить",submit:a});$("#sum").focus().keyEnter(a)}).on("click",".salary ._check:not(#salary_all_check)",salaryCheck).on("click",".salary #salary_all_check",function(){var a,b=$(this).find("input").val(),c=$(".ch");for(a=0;a<c.length;a++)c.eq(a).find("._check input:first")._check(b);
salaryCheck()}).on("click",".salary-list-create",function(){function a(){var a={op:"salary_list_create",worker_id:WORKER_ID,ids:b,sum:c,mon:MON,year:YEAR};e.process();$.post(AJAX_MAIN,a,function(a){a.success?(e.close(),_msg("Лист выдачи з/п создан."),salarySpisok()):e.abort()},"json")}var b=$(this).attr("val");if(b)var c=$("#salary-sum").html(),d='<div class="salary-list-tab"><div class="_info"><b>Создание листа выдачи з/п</b>После формирования листа выдачи з/п все выделенные галочками начисления и вычеты станут фиксированными, то есть их нельзя будет изменить.</div><table><tr><td class="label r">Сотрудник:<TD>'+
WORKER_ASS[WORKER_ID]+'<tr><td class="label r">Выбрано записей:<TD>'+b.split(",").length+'<tr><td class="label r">Сумма:<TD>'+c+' руб.<tr><td class="label r">Месяц:<td>'+MONTH_DEF[MON]+" "+YEAR+'</table><h1><a class="salary-list" val="'+b+'">Предварительный просмотр</a></h1></div>',e=_dialog({width:330,top:30,head:"Создание листа выдачи з/п",content:d,butSubmit:"Сформировать",submit:a})}).on("click",".salary-list",function(){var a=$(this).attr("val");a&&(location.href=SITE+"/view/salary_list.php?"+
VALUES+"&ids="+a)}).on("click",".salary .zp_del",function(){var a=$(this),b=_dialog({top:110,width:250,head:"Удаление з/п",content:"<CENTER>Подтвердите удаление записи.</CENTER>",butSubmit:"Удалить",submit:function(){var c={op:"expense_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?(b.close(),_msg("Удалено."),salarySpisok()):b.abort()},"json")}})}).on("click",".salary .ze_del",function(){for(var a=$(this),b=_dialog({top:110,width:250,head:"Удаление",content:"<CENTER>Подтвердите удаление записи.</CENTER>",
butSubmit:"Удалить",submit:function(){var c={op:"salary_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?(b.close(),_msg("Удалено."),salarySpisok()):b.abort()},"json")}});"TR"!=a[0].tagName;)a=a.parent()}).on("click",".salary .list_del",function(){var a=$(this),b=_dialog({top:110,width:250,head:"Удаление",content:"<CENTER>Подтвердите удаление листа выдачи з/п.</CENTER>",butSubmit:"Удалить",submit:function(){var c={op:"salary_list_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,
c,function(a){a.success?(b.close(),_msg("Удалено."),salarySpisok()):b.abort()},"json")}})}).on("click",".salary-days",function(){var a=_dialog({width:495,top:40,head:"Начисления за определённые дни",load:1,butSubmit:"",butCancel:"Закрыть"}),b={op:"salary_days",id:$(this).attr("val")};$.post(AJAX_MAIN,b,function(b){if(b.success){var d,e=dayFirst(b.year,b.mon),g=dayCount(b.year,b.mon),f='<div id="days-sel-tab"><div id="head-mon">'+MONTH_DEF[b.mon]+" "+b.year+'</div><table id="days-cal"><tr><th>Пн<th>Вт<th>Ср<th>Чт<th>Пт<th>Сб<th>Вс<tr>';
if(1<e)for(d=0;d<e-1;d++)f+="<td>";for(d=1;d<=g;d++)f+='<td class="onday'+(b.all[d]?" all":"")+(b.sel[d]?" sel":"")+'">'+d+(b.all[d]?'<div class="dsum"><b>'+b.all[d]+"</b> руб.</div>":""),e++,8==e&&d!=g&&(f+="<tr>",e=1);a.content.html(f+"</table></div>")}else a.loadError()},"json")}).on("mouseenter",".salary .show",function(){$(this).removeClass("show")}).on("click",".go-report-salary",function(){var a=$(this).attr("val").split(":");location.href=URL+"&p=report&d=salary&id="+a[0]+"&mon="+a[1]+"&acc_id="+
a[2]}).ready(function(){$("#pin-enter").length&&($("#pin").focus().keydown(function(){$(".red").html("&nbsp;")}).keyEnter(pinEnter),$(".vkButton").click(pinEnter));$("#client").length&&($("#find")._search({width:602,focus:1,enter:1,txt:"Начните вводить данные клиента",func:clientSpisok}).inp(C.find),$("#buttonCreate").vkHint({msg:'<B>Внесение нового клиента в базу.</B><br /><br />После внесения Вы попадаете на страницу с информацией о клиенте для дальнейших действий.<br /><br />Клиентов также можно добавлять при <A href="'+
URL+'&p=zayav&d=add&back=client">создании новой заявки</A>.',ugol:"right",width:215,top:-38,left:-250,indent:40,delayShow:1E3}).click(clientAdd),$("#dolg")._check(clientSpisok),$("#dolg_check").vkHint({msg:"<b>Список должников.</b><br /><br />Выводятся клиенты, у которых баланс менее 0. Также в результате отображается общая сумма долга.",ugol:"right",width:150,top:-6,left:-185,indent:20,delayShow:1E3}),$("#worker")._check(clientSpisok),$("#note")._check(clientSpisok),$("#zayav_cat")._select({width:140,
title0:"Любые заявки",spisok:[{uid:1,title:"Заказы"},{uid:2,title:"Замеры"},{uid:3,title:"Договора"},{uid:4,title:"Установки"}],func:clientSpisok}),$("#product_id")._select({width:140,title0:"Любые изделия",spisok:PRODUCT_SPISOK,func:clientSpisok}));$("#clientInfo").length&&($("#dopLinks .link").click(function(){$("#dopLinks .link").removeClass("sel");$(this).addClass("sel");var a=$(this).attr("val");$(".res").css("display","zayav"==a?"block":"none");$("#zayav_filter").css("display","zayav"==a?"block":
"none");$("#zayav_spisok").css("display","zayav"==a?"block":"none");$("#income_spisok").css("display","money"==a?"block":"none");$(".remind_spisok").css("display","remind"==a?"block":"none");$("#comments").css("display","comm"==a?"block":"none");$("#histories").css("display","hist"==a?"block":"none")}),$(".cedit").click(function(){function a(){var e={op:"client_edit",client_id:CLIENT.id,fio:$("#c-fio").val(),telefon:$("#c-telefon").val(),adres:$("#c-adres").val(),worker_id:$("#worker_id").val(),pasp_seria:$("#pasp_seria").val(),
pasp_nomer:$("#pasp_nomer").val(),pasp_adres:$("#pasp_adres").val(),pasp_ovd:$("#pasp_ovd").val(),pasp_data:$("#pasp_data").val()};e.fio?(c.process(),$.post(AJAX_MAIN,e,function(a){a.success?(a.workers=CLIENT.workers,CLIENT=a,$(".left:first").html(a.html),c.close(),_msg("Данные клиента изменены.")):(b(a.text),c.abort())},"json")):(b("Не указано имя клиента"),$("#c-fio").focus())}function b(a){c.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:-47,left:120,indent:50,show:1,remove:1})}var c=
_dialog({head:"Редактирование данных клиента",top:30,width:430,content:'<table class="client-add e"><tr><td class="label">Имя:<td><input type="text" id="c-fio" maxlength="100" value="'+CLIENT.fio+'"><tr><td class="label">Телефон:<td><input type="text" id="c-telefon" maxlength="100" value="'+CLIENT.telefon+'"><tr><td class="label">Адрес:<td><input type="text" id="c-adres" maxlength="100" value="'+CLIENT.adres+'"><tr><td class="label">Связан с сотрудником:<td><input type="hidden" id="worker_id" value="'+
CLIENT.worker_id+'"><tr><td><td><b>Паспортные данные:</b><tr><td class="label">Серия:<td><input type="text" id="pasp_seria" maxlength="8" value="'+CLIENT.pasp_seria+'"><span class="label">Номер:</span><input type="text" id="pasp_nomer" maxlength="10" value="'+CLIENT.pasp_nomer+'"><tr><td class="label">Прописка:<td><input type="text" id="pasp_adres" maxlength="100" value="'+CLIENT.pasp_adres+'"><tr><td class="label">Кем выдан:<td><input type="text" id="pasp_ovd" maxlength="100" value="'+CLIENT.pasp_ovd+
'"><tr><td class="label">Когда выдан:<td><input type="text" id="pasp_data" maxlength="100" value="'+CLIENT.pasp_data+'"></table>',butSubmit:"Сохранить",submit:a});$("#worker_id")._select({width:180,title0:"Не выбран",spisok:CLIENT.workers});$("#c-fio,#c-telefon,#c-adres,#pasp_seria,#pasp_nomer,#pasp_adres,#pasp_ovd,#pasp_data").keyEnter(a)}),$(".cdel").click(function(){var a=_dialog({top:90,width:300,head:"Удаление клиента",content:"<center>Внимание!<br />Будут удалены все данные о клиенте,<br />его заявки, платежи и задачи.<br /><b>Подтвердите удаление.</b></center>",
butSubmit:"Удалить",submit:function(){var b={op:"client_del",id:CLIENT.id};a.process();$.post(AJAX_MAIN,b,function(b){b.success?(a.close(),_msg("Клиент удален!"),location.href=URL+"&p=client"):a.abort()},"json")}})}));if($("#zayav").length){$("#find")._search({width:153,focus:1,txt:"Быстрый поиск...",enter:1,func:zayavFindFast}).vkHint({width:220,msg:"<b>Быстрый поиск</b> производится одновременно по всем категориям заявок. Учитываются поля: номер договора, номера ВГ, Ж, Д, адрес установки, Фио и телефоны клиентов и порядковый номер заявки. Другие условия фильтра игонрируются.",
ugol:"top",indent:"right",delayShow:1E3,top:45,left:384});$("#status").rightLink(zayavSpisok);for(var a=[],b=0;b<PRODUCT_IDS.length;b++){var c=PRODUCT_IDS[b];a.push({uid:c,title:PRODUCT_ASS[c]})}$("#product_id")._select({width:155,title0:"Любые изделия",spisok:a,func:zayavSpisok});$("#zp_expense")._radio(function(a){$("#zpe_worker_select")[(3==a?"remove":"add")+"Class"]("dn");$("#zpe_worker")._select(0);zayavSpisok()});$("#zpe_worker").length&&$("#zpe_worker")._select({width:155,title0:"Сотрудник не выбран",
spisok:ZPE_WORKER,func:zayavSpisok});$("#zpe_worker_select").addClass("dn");$("#account")._check(zayavSpisok)}$(".zayav-info").length&&($(".zinfo").click(function(){$(this).parent().find(".sel").removeClass("sel");$(this).addClass("sel");$(".zayav-info").removeClass("h")}),$(".hist").click(function(){$(this).parent().find(".sel").removeClass("sel");$(this).addClass("sel");$(".zayav-info").addClass("h")}),$(".dogovor_create").click(dogovorCreate),$(".dogovor_no_require").click(function(){$.post(AJAX_MAIN,
{op:"dogovor_no_require",zayav_id:ZAYAV.id},function(a){a.success&&document.location.reload()},"json")}),$("#dogovor_action")._dropdown({head:"Не заключен",spisok:[{uid:1,title:"Заключить договор"},{uid:2,title:'Перевести заявку в категорию "Требуется договор"'}],nosel:1,func:function(a){1==a&&dogovorCreate();2==a&&$.post(AJAX_MAIN,{op:"dogovor_require",zayav_id:ZAYAV.id},function(a){a.success&&document.location.reload()},"json")}}),$("#dogovor_reaction")._dropdown({head:"Действие",headgrey:1,spisok:[{uid:1,
title:"Изменение данных договора"},{uid:3,title:"Расторжение"}],nosel:1,func:function(a){1==a&&dogovorCreate("edit");3==a&&dogovorDestroy()}}),$(".zakaz_edit").click(function(){function a(){var c,e={op:"zakaz_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),zakaz_txt:$("#zakaz_txt").val(),nomer_vg:$("#nomer_vg").val(),nomer_g:$("#nomer_g").val(),nomer_d:$("#nomer_d").val(),nomer_t:$("#nomer_t").val()};e.product||e.zakaz_txt?"count_error"==e.product?c="Некорректно введено количество изделий":
(b.process(),$.post(AJAX_MAIN,e,function(a){a.success?(b.close(),_msg("Данные изменены!"),document.location.reload()):b.abort()},"json")):c="Необходимо выбрать изделие или вписать заказ вручную";c&&b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}var b=_dialog({width:500,top:30,head:ZAYAV.head+" - Редактирование",content:'<table class="zayav-info-edit"><tr><td class="label">Клиент:      <td>'+ZAYAV.client_fio+'<tr><td class="label topi">Изделие:<td id="product"><tr><td><td><input type="text" id="zakaz_txt" placeholder="либо укажите содержание заказа вручную.." maxlength="300" value="'+
ZAYAV.zakaz_txt+'"><tr><td class="label">Номер ВГ:\t<td><INPUT type="text" id="nomer_vg" maxlength="30" value="'+ZAYAV.nomer_vg+'" /><tr><td class="label">Номер Ж: \t<td><INPUT type="text" id="nomer_g" maxlength="30" value="'+ZAYAV.nomer_g+'" /><tr><td class="label">Номер Д: \t<td><INPUT type="text" id="nomer_d" maxlength="30" value="'+ZAYAV.nomer_d+'" /><tr><td class="label">Номер T: \t<td><INPUT type="text" id="nomer_t" maxlength="30" value="'+ZAYAV.nomer_t+'" /></table>',butSubmit:"Сохранить",
submit:a});$("#product").productList(ZAYAV.product);$("#zakaz_txt").keyEnter(a)}),$(".zamer_edit").click(function(){function a(c){b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}var b=_dialog({width:500,top:30,head:ZAYAV.head+" - Редактирование",content:'<table class="zayav-info-edit"><tr><td class="label">Клиент:        <td>'+ZAYAV.client_fio+'<tr><td class="label top">Изделие:\t<td id="product"><tr><td class="label">Адрес замера:  <td><INPUT type="text" id="adres" maxlength="100" value="'+
ZAYAV.adres+'" /><tr><td class="label">Дата и время замера:<td class="zayav-zamer-dtime"><tr><td class="label">Длительность замера:<td><INPUT TYPE="hidden" id="zamer_duration" value="'+ZAYAV.dur+'" /><a class="zamer_table" val="'+ZAYAV.id+'">Таблица замеров</a></table>',butSubmit:"Сохранить",submit:function(){var c={op:"zamer_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),adres:$("#adres").val(),zamer_day:$("#zamer_day").val(),zamer_hour:$("#zamer_hour").val(),zamer_min:$("#zamer_min").val(),
zamer_duration:$("#zamer_duration").val()};c.product?"count_error"==c.product?a("Некорректно введено количество изделий"):c.adres?(b.process(),$.post(AJAX_MAIN,c,function(c){c.success?(b.close(),_msg("Данные изменены!"),document.location.reload()):(b.abort(),a(c.text))},"json")):a("Не указан адрес"):a("Не указано изделие")}});$("#product").productList(ZAYAV.product);zayavZamerDtime(ZAYAV)}),$(".dog_edit").click(function(){var a=_dialog({width:500,top:30,head:"Редактирование",content:'<table class="zayav-info-edit"><tr><td class="label">Клиент:      <td>'+
ZAYAV.client_fio+'<tr><td class="label top">Изделие:\t<td id="product"><tr><td class="label">Адрес установки:<td><INPUT type="text" id="adres" maxlength="100" value="'+ZAYAV.adres+'" /></table>',butSubmit:"Сохранить",submit:function(){var b,c={op:"dog_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),adres:$("#adres").val()};c.product?"count_error"==c.product?b="Некорректно введено количество изделий":c.adres?(a.process(),$.post(AJAX_MAIN,c,function(b){b.success?(a.close(),_msg("Данные изменены!"),
document.location.reload()):a.abort()},"json")):b="Не указан адрес":b="Не указано изделие";b&&a.bottom.vkHint({msg:'<SPAN class="red">'+b+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}});$("#product").productList(ZAYAV.product)}),$(".set_edit").click(function(){function a(){var c,d={op:"set_edit",zayav_id:ZAYAV.id,product:$("#product").productList("get"),adres:$("#adres").val(),nomer_vg:$("#nomer_vg").val(),nomer_g:$("#nomer_g").val(),nomer_d:$("#nomer_d").val(),nomer_t:$("#nomer_t").val()};
d.product?"count_error"==d.product?c="Некорректно введено количество изделий":d.adres?(b.process(),$.post(AJAX_MAIN,d,function(a){a.success?(b.close(),_msg("Данные изменены!"),document.location.reload()):b.abort()},"json")):c="Не указан адрес":c="Не указано изделие";c&&b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-47,left:161,indent:40,show:1,remove:1})}var b=_dialog({width:500,top:30,head:ZAYAV.head+" - Редактирование",content:'<table class="zayav-info-edit"><tr><td class="label">Клиент:      <td>'+
ZAYAV.client_fio+'<tr><td class="label top">Изделие:\t<td id="product"><tr><td class="label">Адрес установки:<td><INPUT type="text" id="adres" maxlength="100" value="'+ZAYAV.adres+'" /><tr><td class="label">Номер ВГ:\t   <td><INPUT type="text" id="nomer_vg" maxlength="30" value="'+ZAYAV.nomer_vg+'" /><tr><td class="label">Номер Ж: \t   <td><INPUT type="text" id="nomer_g" maxlength="30" value="'+ZAYAV.nomer_g+'" /><tr><td class="label">Номер Д: \t   <td><INPUT type="text" id="nomer_d" maxlength="30" value="'+
ZAYAV.nomer_d+'" /><tr><td class="label">Номер T: \t   <td><INPUT type="text" id="nomer_t" maxlength="30" value="'+ZAYAV.nomer_t+'" /></table>',butSubmit:"Сохранить",submit:a});$("#product").productList(ZAYAV.product);$("#adres,#nomer_vg,#nomer_g,#nomer_d,#nomer_t").keyEnter(a)}),$(".acc-add").click(function(){function a(){var c,d={op:"accrual_add",zayav_id:ZAYAV.id,sum:$("#sum").val(),prim:$("#prim").val()};REGEXP_CENA.test(d.sum)?(b.process(),$.post(AJAX_MAIN,d,function(a){b.abort();a.success&&
(zayavInfoMoneyUpdate(),b.close(),_msg("Начисление успешно произведено."),$("#income_spisok").html(a.html))},"json")):(c="Некорректно указана сумма.",$("#sum").focus());c&&b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-48,left:123,indent:40,remove:1,show:1})}var b=_dialog({width:420,head:"Начисление",content:'<table class="accrual-add"><tr><td class="label">Сумма: <td><input type="text" id="sum" class="money" maxlength="11" /> руб.<tr><td class="label">Примечание:<em>(не обязательно)</em><td><input type="text" id="prim" maxlength="100" /></table>',
submit:a});$("#sum").focus();$("#sum,#prim").keyEnter(a)}),$(".delete").click(function(){var a=_dialog({top:110,width:250,head:"Удаление заявки",content:"<CENTER>Подтвердите удаление заявки.</CENTER>",butSubmit:"Удалить",submit:function(){var b={op:"zayav_delete",zayav_id:ZAYAV.id};a.process();$.post(AJAX_MAIN,b,function(a){a.success&&(location.href=URL+"&p=client&d=info&id="+a.client_id)},"json")}})}),$(".expense-edit").click(function(){var a=_dialog({width:510,top:30,head:"Изменение расходов заявки",
content:'<table class="zayav-expense-edit"><tr><td class="label">Заявка: <td><b>'+ZAYAV.head+'</b><tr><td class="label topi">Расходы:<td><tr><td colspan="2" id="zrs"></table>',butSubmit:"Сохранить",submit:function(){var b={op:"zayav_expense_edit",zayav_id:ZAYAV.id,rashod:$("#zrs").zayavExpense("get")};"sum_error"==b.rashod?a.bottom.vkHint({msg:'<SPAN class="red">Некорректно указана сумма</SPAN>',top:-47,left:167,indent:40,show:1,remove:1}):(a.process(),$.post(AJAX_MAIN,b,function(b){b.success?($(".zrashod").html(b.html),
$("#hspisok").html(b.history),ZAYAV.rashod=b.array,a.close(),_msg("Сохранено.")):a.abort()},"json"))}});$("#zrs").zayavExpense(ZAYAV.rashod)}),$(".zakaz-to-set").click(function(){function a(){var c={op:"zakaz_to_set",zayav_id:ZAYAV.id,adres:$("#adres").val()};c.adres?(b.process(),$.post(AJAX_MAIN,c,function(a){b.abort();a.success&&(b.close(),_msg("Выполнено."),document.location.reload())},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">Не указан адрес установки</SPAN>',top:-48,left:113,indent:40,
remove:1,show:1}),$("#adres").focus())}var b=_dialog({width:400,head:"Перенос заказа в установку",content:'<table class="_dialog-tab"><tr><td class="label">Клиент:<td>'+ZAYAV.client_fio+'<tr><td class="label">Адрес установки:<td><INPUT type="text" id="adres" maxlength="100" value="'+ZAYAV.adres+'" /><INPUT type="hidden" id="homeadres" /></table>',butSubmit:"Перенести",submit:a});$("#adres").focus().keyEnter(a);$("#homeadres")._check({func:function(){$("#adres").val(ZAYAV.client_adres)}});$("#homeadres_check").vkHint({msg:"Совпадает с адресом проживания клиента",
top:-75,left:163,indent:60,delayShow:400})}),$(".set-to-zakaz").click(function(){var a=_dialog({head:"Перенос установки в заказы",content:'<table class="_dialog-tab"><tr><td class="label">Заявка:<td><b>'+ZAYAV.head+'</b><tr><td class="label">Клиент:<td>'+ZAYAV.client_fio+"</table>",butSubmit:"Перенести",submit:function(){var b={op:"set_to_zakaz",zayav_id:ZAYAV.id};a.process();$.post(AJAX_MAIN,b,function(b){b.success?(a.close(),_msg("Выполнено."),location.reload()):a.abort()},"json")}})}),$(".refund-add").click(function(){function a(){var c=
{op:"refund_add",zayav_id:ZAYAV.id,invoice_id:1*$("#invoice_id").val(),sum:$("#sum").val(),prim:$.trim($("#prim").val())};c.invoice_id?REGEXP_CENA.test(c.sum)?(d.process(),$.post(AJAX_MAIN,c,function(a){d.abort();a.success&&(d.close(),zayavInfoMoneyUpdate(),_msg("Возврат успешно произведён."),$("#income_spisok").html(a.html))},"json")):(b("Некорректно указана сумма"),$("#sum").focus()):b("Не указан счёт")}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:100,indent:40,
remove:1,show:1})}var c='<table class="refund-add-tab"><tr><td class="label">Клиент:<td>'+OPL.client_fio+'<tr><td class="label">Со счёта:<TD><INPUT type="hidden" id="invoice_id"><a href="'+URL+'&p=setup&d=invoice" class="img_edit'+_tooltip("Настройка счетов",-56)+'</a><tr><td class="label">Сумма:<td><input type="text" id="sum" class="money" maxlength="11" /> руб.<span id="isum"></span><tr><td class="label">Комментарий:<td><input type="text" id="prim" maxlength="100" /></table>',d=_dialog({width:370,
head:"Возврат",content:c,submit:a});$("#sum").focus();$("#sum,#prim").keyEnter(a);$("#invoice_id")._select({title0:"Не выбран",spisok:INVOICE_SPISOK,func:function(a){$("#sum").focus();$("#isum").html(ZAYAV.isum[a]?"max: <b>"+ZAYAV.isum[a]+"</b>":"")}})}));$("#remind").length&&($(".goyear").click(function(){$("#remind").addClass("y")}),window._calendarFilter=remindSpisok,$("#status")._radio(remindSpisok),$("#private")._check(remindSpisok));$("#report.history").length&&($("#viewer_id_add")._select({width:160,
title0:"Все сотрудники",spisok:WORKERS,func:_history}),$("#action")._select({width:160,title0:"Любая категория",spisok:HISTORY_GROUP,func:_history}));$("#report.income").length&&(window._calendarFilter=incomeSpisok,$("#income_id")._select({width:160,title0:"Любые платежи",spisok:INCOME_SPISOK,func:incomeSpisok}),window.WORKERS&&$("#worker_id")._select({width:160,title0:"Все сотрудники",spisok:WORKERS,func:incomeSpisok}),$("#deleted")._check(incomeSpisok));$("#report.expense").length&&($(".add").click(function(){function a(){var c=
{op:"expense_add",category:1*$("#cat").val(),about:$("#about").val(),worker:$("#work").val(),invoice:1*$("#invoice").val(),sum:$("#sum").val(),mon:$("#tabmon").val(),year:$("#tabyear").val()};c.category||c.about?c.invoice?REGEXP_CENA.test(c.sum)&&0!=c.sum?(d.process(),$.post(AJAX_MAIN,c,function(a){a.success?(d.close(),_msg("Новый расход внесён."),expenseSpisok()):d.abort()},"json")):(b("Некорректно указана сумма."),$("#sum").focus()):b("Укажите с какого счёта производится оплата."):(b("Выберите категорию или укажите описание."),
$("#about").focus())}function b(a){d.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:101})}var c='<table id="expense-add-tab"><tr><td class="label">Категория:<TD><INPUT type="hidden" id="cat"><a href="'+URL+'&p=setup&d=expense" class="img_edit'+_tooltip("Настройка категорий расходов",-95)+'</a><tr class="tr-work dn"><td class="label">Сотрудник:<TD><INPUT type="hidden" id="work"><tr class="tr-work dn"><td class="label">Месяц:<td><input type="hidden" id="tabmon" value="'+
((new Date).getMonth()+1)+'" /> <input type="hidden" id="tabyear" value="'+(new Date).getFullYear()+'" /><tr><td class="label">Описание:<TD><INPUT type="text" id="about" maxlength="100"><tr><td class="label">Со счёта:<TD><INPUT type="hidden" id="invoice"><a href="'+URL+'&p=setup&d=invoice" class="img_edit'+_tooltip("Настройка счетов",-56)+'</a><tr><td class="label">Сумма:<TD><INPUT type="text" id="sum" class="money" maxlength="11"> руб.</table>',d=_dialog({width:380,head:"Внесение расхода",content:c,
submit:a});$("#cat")._select({width:180,title0:"Не указана",spisok:EXPENSE_SPISOK,func:function(a){$("#work")._select(0);$(".tr-work")[(EXPENSE_WORKER[a]?"remove":"add")+"Class"]("dn")}});$("#about").focus();$("#work")._select({title0:"Не выбран",spisok:WORKER_SPISOK});$("#invoice")._select({title0:"Не выбран",spisok:INVOICE_SPISOK,func:function(){$("#sum").focus()}});$("#sum,#about").keyEnter(a);$("#tabmon")._select({width:80,spisok:MON_SPISOK});$("#tabyear")._select({width:60,spisok:YEAR_SPISOK})}),
$("#category")._select({width:160,title0:"Любая категория",spisok:EXPENSE_SPISOK,func:expenseSpisok}),$("#worker")._select({width:160,title0:"Все сотрудники",spisok:WORKERS,func:expenseSpisok}),$("#invoice_id")._radio(expenseSpisok),$("#year").years({func:expenseSpisok,center:function(){var a=$("#monthList input"),c=0;for(b=1;12>=b;b++)if(0==a.eq(b-1).val()){c=1;break}for(b=1;12>=b;b++)$("#c"+b)._check(c);expenseSpisok()}}));$("#report.invoice").length&&$(".transfer").click(function(){function a(){var b=
{op:"invoice_transfer",from:1*$("#from").val(),to:1*$("#to").val(),sum:$("#sum").val(),ids:$("#ids").val()};b.from?b.to?b.from==b.to?c("Выберите другой счёт"):REGEXP_CENA.test(b.sum)&&0!=b.sum?(d.process(),$.post(AJAX_MAIN,b,function(a){a.success?($("#cash-spisok").html(a.c),$("#invoice-spisok").html(a.i),$(".transfer-spisok").html(a.t),d.close(),_msg("Перевод произведён.")):d.abort()},"json")):(c("Некорректно введена сумма"),$("#sum").focus()):c("Выберите счёт-получатель"):c("Выберите счёт-отправитель")}
function c(a,b){d.bottom.vkHint({msg:'<span class="red">'+a+"</span>",top:b?-95:-47,left:b?197:92,indent:50,show:1,remove:1})}$(this);var d=_dialog({width:380,head:"Перевод между счетами",content:'<table class="invoice-transfer"><tr><td class="label">Со счёта:<td><input type="hidden" id="from" /><tr><td class="label">На счёт:<td><input type="hidden" id="to" /><tr><td class="label">Сумма:<td><input type="text" id="sum" class="money" /> руб. <a class="income-choice">Выбрать платежи</a><input type="hidden" id="ids" /></table>',
butSubmit:"Применить",submit:a});if(window.CASH_SPISOK&&!window.CSMOVE){for(b=0;b<INVOICE_SPISOK.length;b++)1!=INVOICE_SPISOK[b].uid&&CASH_SPISOK.push(INVOICE_SPISOK[b]);INVOICE_SPISOK=CASH_SPISOK;window.CSMOVE=1}$("#from")._select({width:250,title0:"Не выбран",spisok:INVOICE_SPISOK,func:function(a){$(".income-choice").html("Выбрать платежи");$("#ids").val("");$("#sum").val("").attr("readonly",SELMONEY[a]?!0:!1)}});$("#to")._select({width:250,title0:"Не выбран",spisok:INVOICE_SPISOK});$("#sum").keyEnter(a);
$("#sum").keyup(function(){$("#ids").val()&&($(".income-choice").html("Выбрать платежи"),$("#ids").val(""),$("#sum").val(""))});$(".income-choice").click(function(){function a(){var c=incomeChoiceSum();$("#ids").val(c.ids);$(".income-choice").html(c.count+" платеж"+_end(c.count,["","а","ей"]));$("#sum").val(c.sum);b.close()}if(0==$("#from").val())c("Не выбран счёт-отправитель",1);else{var b=_dialog({top:20,width:480,head:"Выбор платежей для перевода",load:1,butSubmit:"Готово",submit:a}),d={op:"income_choice",
owner_id:$("#from").val(),ids:$("#ids").val()};$.post(AJAX_MAIN,d,function(a){a.success?(b.content.html(a.html+'<div class="income_choice_sum"></div>'),incomeChoiceSum()):b.loadError()},"json")}})});if($("#report.salary").length)if($("#uall").length){$("#uall")._check(function(a){var c=$("._check");for(b=1;b<c.length;b++)c.eq(b).find("input")._check(a)});var a=[],d;for(d in MONTH_DEF)a.push({uid:d,title:MONTH_DEF[d]});$("#rmon")._select({width:100,spisok:a});$("#ryear")._select({width:60,spisok:YEARS});
$(".vkButton").click(function(){var a=$(this),c=$("._check"),d=[];for(b=1;b<c.length;b++){var h=c.eq(b).find("input");1==h.val()&&d.push(h.attr("id").split("u")[1])}(c=d.join())?document.location.href=SITE+"/view/salary_report.php?"+VALUES+"&ids="+c+"&mon="+$("#rmon").val()+"&year="+$("#ryear").val():a.vkHint({msg:'<span class="red">Не выбраны сотрудники</span>',top:-57,left:7,indent:50,show:1,remove:1})})}else $("#year").years({func:salarySpisok}),$("#salmon")._radio({func:salarySpisok})});
